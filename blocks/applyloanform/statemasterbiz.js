import{brachDropDownUl as f,branchInput as L,loanProduct as h,stateDropDownUL as C,stateInput as g}from"./loanformdom.js";import{statemasterDataMap as l}from"./statemasterDataMapping.js";let m=l.get("statemasterGlobal")||{},y={},p=[],S=document.createElement("li");S.textContent="No options",S.classList.add("orangepoints");const D=f()?.querySelector(".orangepoints")||S;function k(o){return o.filter(t=>!!t.state&&t.state!="#N/A").reduce((t,i)=>{const s={},n={};return n.data=i.data.map(a=>JSON.parse(a)),n.cities=n.data.reduce((a,c)=>(a.includes(c.city)||a.push(c.city),a),[]),s[i.state.trim()]=n,Object.assign(t,s),t},{})}function x(o){const e=Object.keys(o).sort();b(e),document.querySelectorAll(".expert").forEach(t=>{t.addEventListener("click",()=>{b(e),f().replaceChildren(D),y={},p=[]})}),g().addEventListener("change",({currentTarget:t})=>{const i=(p.length?p:e).filter(s=>s.toLowerCase()===t.value.toLowerCase())[0];i?(w(i),t.classList.add("place-selected")):(w([]),t.classList.remove("place-selected")),L().value=""}),h().addEventListener("change",({currentTarget:t})=>{N(t.dataset.loanType)}),g().addEventListener("keyup",({currentTarget:t})=>{const i=C(),s=(p.length?p:e).filter(a=>a.toLocaleLowerCase().includes(t.value.trim().toLocaleLowerCase())),n=s.length>0?d(s,"form-state","States"):d(s,"form-state","No options");i.replaceChildren(n)}),g().addEventListener("input",({currentTarget:t})=>{(p.length&&h().value?p:e).map(s=>s.toLocaleLowerCase()).includes(t.value.trim().toLocaleLowerCase())?t.classList.add("place-selected"):t.classList.remove("place-selected")})}function w(o){const e=f(),t=(h().value.trim()!=""?y[o]?.cities:m[o]?.cities)||[],i=t.length>0?d(t,"form-branch-city","Cities"):d(t,"form-branch-city","No options");e.replaceChildren(i),l.set("loanCities",t),e.dataset.keyup||(L().addEventListener("keyup",({currentTarget:s})=>{const a=l.get("loanCities").filter(u=>u.toLocaleLowerCase().includes(s.value.trim().toLocaleLowerCase())),c=a.length>0?d(a,"form-branch-city","Cities"):d(a,"form-branch-city","No options");e.replaceChildren(c)}),e.dataset.keyup=!0),e.dataset.input||(L().addEventListener("input",({currentTarget:s})=>{l.get("loanCities").map(c=>c.toLocaleLowerCase()).includes(s.value.trim().toLocaleLowerCase())?s.classList.add("place-selected"):s.classList.remove("place-selected")}),e.dataset.input=!0)}function d(o,e,r){const t=new DocumentFragment,i=document.createElement("li");i.textContent=r,i.classList.add("orangepoints"),t.append(i);for(const s of o){const n=document.createElement("li");n.dataset.getInput=e,n.textContent=s,n.classList.add("subpoints"),t.append(n)}return t}function F(o){return o.cloneNode(!0)}export function workFlowStatemaster(o){const e=k(o);x(e),l.set("statemasterGlobal",e),m=e}function b(o){const e=C(),r=d(o,"form-state","States"),t=F(r);e.replaceChildren(t)}function N(o){const e=o,r={};for(const n in m){const a=m[n].data,c={cities:[]};for(let u=0;u<a.length;u++){const E=c.cities.includes(a[u].city);if(c.cities.length==m[n].cities.length)break;if(E)continue;const v=a[u].product.split(",");if(v.length==4){c.cities.push(a[u].city);continue}v.includes(e)&&c.cities.push(a[u].city)}c.cities.length&&(r[n]=c)}const t=Object.keys(r).sort(),i=t.length>0?d(t,"form-state","States"):d(t,"form-state","No options");C().replaceChildren(i),l.set("productStatemaster",r),y=l.get("productStatemaster"),l.set("productStates",t),p=l.get("productStates")}

