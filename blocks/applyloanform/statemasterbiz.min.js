import{brachDropDownUl as y,branchInput as g,loanProduct as L,stateDropDownUL as w,stateInput as S}from"./loanformdom.min.js";import{statemasterDataMap as d}from"./statemasterDataMapping.min.js";import{clearPLLoanError as P,validatePLLoan as F}from"./validation.min.js";import{statemasterGetStatesApi as E}from"./statemasterapi.min.js";let h=d.get("statemasterGlobal")||{},v={},u=[],D=!1,b=document.createElement("li");b.textContent="No options",b.classList.add("orangepoints");const A=y()?.querySelector(".orangepoints")||b;export function stateMasterProcessGraphqlData(o){return o.filter(t=>!!t.state&&t.state!="#N/A").reduce((t,s)=>{const a={},n={};return n.data=s.data.map(i=>JSON.parse(i)),n.cities=n.data.reduce((i,l)=>(i.includes(l.city)||i.push(l.city),i),[]),a[s.state.trim()]=n,Object.assign(t,a),t},{})}export function stateMasterProcessApiData(o){const e={};return o.forEach(c=>{if(!c.State)return;const t=c.State.trim().toLowerCase().replace(/\b\w/g,a=>a.toUpperCase());e[t]||(e[t]={cities:[],data:[]});const s=c.location.trim();e[t].cities.includes(s)||e[t].cities.push(s),e[t].data.push({city:s,locationID:null,product:c["Product Code"]?c["Product Code"].toLowerCase():null})}),e}function O(o){const e=Object.keys(o).sort();x(e),D||(document.querySelectorAll(".expert").forEach(t=>{t.addEventListener("click",()=>{x(e),y().replaceChildren(A),v={},u=[]})}),S().addEventListener("change",({currentTarget:t})=>{const s=(u.length?u:e).filter(a=>a.toLowerCase()===t.value.toLowerCase())[0];s?(k(s),t.classList.add("place-selected")):(k([]),t.classList.remove("place-selected")),g().value=""}),L().addEventListener("change",({currentTarget:t})=>{z(t.dataset.loanType),P(),F();const s=["pl","las","lamf"].includes(t.dataset.loanType),a=d.get("allowedType"),n=typeof a=="boolean"?a:!1;s&&!n?(E(t.dataset.loanType),d.set("allowedType",!0)):!s&&n&&(E(t.dataset.loanType),d.set("allowedType",!1))}),S().addEventListener("keyup",({currentTarget:t})=>{const s=w(),a=(u.length?u:e).filter(i=>i.toLocaleLowerCase().includes(t.value.trim().toLocaleLowerCase())),n=a.length>0?p(a,"form-state","States"):p(a,"form-state","No options");s.replaceChildren(n)}),S().addEventListener("input",({currentTarget:t})=>{(u.length&&L().value?u:e).map(a=>a.toLocaleLowerCase()).includes(t.value.trim().toLocaleLowerCase())?t.classList.add("place-selected"):t.classList.remove("place-selected")}),D=!0)}function k(o){const e=y(),c=L().value.trim()!="",t=L().dataset.loanType,s=["pl","las","lamf"].includes(t),a=(c&&!s?v[o]?.cities:h[o]?.cities)||[],n=a.length>0?p(a,"form-branch-city","Cities"):p(a,"form-branch-city","No options");e.replaceChildren(n),d.set("loanCities",a),e.dataset.keyup||(g().addEventListener("keyup",({currentTarget:i})=>{const l=d.get("loanCities"),r=f=>f.toLowerCase().replace(/[^a-z]/g,""),C=l.map(f=>r(f)).includes(r(i.value)),m=serachCities.length>0?p(serachCities,"form-branch-city","Cities"):p(serachCities,"form-branch-city","No options");e.replaceChildren(m)}),e.dataset.keyup=!0),e.dataset.input||(g().addEventListener("input",({currentTarget:i})=>{const l=d.get("loanCities"),r=m=>m.toLowerCase().replace(/[^a-z]/g,"");l.map(m=>r(m)).includes(r(i.value))?i.classList.add("place-selected"):i.classList.remove("place-selected")}),e.dataset.input=!0)}function p(o,e,c){const t=new DocumentFragment,s=document.createElement("li");s.textContent=c,s.classList.add("orangepoints"),t.append(s);for(const a of o){const n=document.createElement("li");n.dataset.getInput=e,n.textContent=a,n.classList.add("subpoints"),t.append(n)}return t}function G(o){return o.cloneNode(!0)}export function workFlowStatemaster(o){O(o),d.set("statemasterGlobal",o),h=o}function x(o){const e=w(),c=p(o,"form-state","States"),t=G(c);e.replaceChildren(t)}function z(o){const e=o,c={};for(const n in h){const i=h[n].data,l={cities:[]};for(let r=0;r<i.length;r++){const C=l.cities.includes(i[r].city);if(l.cities.length==h[n].cities.length)break;if(C)continue;const f=i[r].product.split(",").map(N=>N.trim());if(f.length==4){l.cities.push(i[r].city);continue}f.includes(e)&&l.cities.push(i[r].city)}l.cities.length&&(c[n]=l)}const t=Object.keys(c).sort(),s=t.length>0?p(t,"form-state","States"):p(t,"form-state","No options");w().replaceChildren(s),v=c,d.set("productStatemaster",c),u=c,d.set("productStates",t)}
