import{calculatorFlatStrLogic as b,CFApiCall as O}from"../../scripts/common.min.js";import{homeLoanCalcFunc as F}from"../emiandeligiblitycalc/homeloancalculators.min.js";import{homeloanCalHTML as I}from"../homeloancalculatorv2/templatehtmlv2.min.js";export default async function E(t){const e=t.textContent.trim(),a=(e&&await O(e)).data,r=b(a);t.innerHTML=I(r);let m,n;try{m=document.querySelector(".home-page-calculator-call-xf"),n=m.querySelector(".cmp-container--caloverlay");const l=document.querySelector(".home-page-calculator-call-xf");document.querySelector(".home-loan-calculator-parent").classList.contains("combined-emi-eligibility")&&(document.querySelector(".home-loan-calculator-parent").classList.remove("combined-emi-eligibility"),document.querySelector(".homeloancalculator").querySelector(".eligibilitycalculator")&&(document.querySelector(".homeloancalculator").querySelector(".eligibilitycalculator").style.display="block")),F(l),L(),N(t)}catch(l){console.warn(l)}}function L(){const t=document.querySelector(".homeloancalculator .apr");if(t){let q=function(){const c={};return c.loanAmt=e.querySelector("[data-cal-input=loanamt]")?.value.replaceAll(",",""),c.roi=e.querySelector("[data-cal-input=roi]")?.value.replaceAll(",",""),c.tenure=e.querySelector("[data-cal-input=tenure]")?.value,c.loanOrigination=e.querySelector("[data-cal-input=origincharges")?.value.replaceAll(",",""),c};const e=t.closest(".homeloancalculator"),i=e.querySelector("[data-cal-result=resultAmt]"),{loanAmt:a,loanOrigination:r,roi:m,tenure:n}=q(),l=CheckAprRate(a,r,m,n);A(i,l),e.addEventListener("change",({target:c})=>{if(c.tagName!="INPUT")return;const{loanAmt:x,loanOrigination:g,roi:M,tenure:s}=q(),p=CheckAprRate(x,g,M,s);A(i,p)})}}function A(t,e){t.textContent=`${e}%`}export const CheckAprRate=(t,e,i,a)=>{const r=t-e,m=.01,n=0,l=0,c=i/100/12,x=0,g=(1+c)**a,s=c/(g-1)*-(t*g+x),p=1e-10,R=10;let y,f,d,C,h=0,u=0,v=0,o=m;for(Math.abs(o)<p?y=r*(1+a*o)+s*(1+o*l)*a+n:(u=Math.exp(a*Math.log(1+o)),y=r*u+s*(1/o+l)*(u-1)+n),f=r+s*a+n,d=r*u+s*(1/o+l)*(u-1)+n,v=C=0,h=o;Math.abs(f-d)>p&&v<R;)o=(d*C-f*h)/(d-f),C=h,h=o,Math.abs(o)<p?y=r*(1+a*o)+s*(1+o*l)*a+n:(u=Math.exp(a*Math.log(1+o)),y=r*u+s*(1/o+l)*(u-1)+n),f=d,d=y,++v;let S=o*100*12;return S=isNaN(S)?0:S,S.toFixed(2)};function N(t){if(document.querySelector(".discalimer-details").classList.remove("dp-none"),t.querySelector(".discalimer-calc")){const e=t.querySelector(".read-more-discalimer-calc"),i=t.querySelector(".disclaimer-container");e.addEventListener("click",a=>{a.target.textContent.trim()=="Read more"?(i.classList.remove("dp-none"),e.textContent="Read less"):a.target.textContent.trim()=="Read less"&&(i.classList.add("dp-none"),e.textContent="Read more")})}}
