import{ctaClickInteraction as q}from"../../dl.min.js";import{fetchAPI as x,getProps as L,renderHelper as D}from"../../scripts/common.min.js";export default async function T(r){const a=L(r),[c,g,m]=a,n=m==="ascending";if(r.innerHTML="",!c){console.error("API URL is required for financialreports block");return}try{let E=function(t){r.querySelectorAll(".subAccordianBox").forEach(e=>{t.target.parentElement.classList.contains("active")||(e.classList.remove("active"),e.querySelectorAll(".subAccordianContent,.grey-border").forEach(o=>{o.style.display="none"}))});const l=t.target.parentNode,d=getSiblings(l);l.classList.toggle("active"),d.forEach(e=>{e.classList.remove("active")}),l.querySelectorAll(".subAccordianContent").forEach(e=>{const o=window.getComputedStyle(e);e.parentElement.style.display=o.getPropertyValue("display")==="none"?"block":"none",e.style.display=o.getPropertyValue("display")==="none"?"block":"none"}),d.forEach(e=>{const o=e.querySelector(".subAccordianContent");window.getComputedStyle(o).getPropertyValue("display")==="block"&&(o.style.display="none")});try{const e={};e.click_text=t.target.textContent.trim(),e.cta_position=t.target.closest(".section").querySelector(".default-content-wrapper").querySelector("h1, h2, h3, h4, h5, h6").textContent.trim(),q(e)}catch(e){console.warn(e)}};const u=await(await x("GET",c)).json(),y=u.result&&Array.isArray(u.result)?u.result[0]:u,w=Object.keys(y).sort((t,l)=>{const d=parseInt(t.split("-")[0]),p=parseInt(l.split("-")[0]);return n?d-p:p-d}),v=["January","February","March","April","May","June","July","August","September","October","November","December"];w.forEach(t=>{const l=Array.isArray(y[t])?y[t][0]:y[t],d=Object.keys(l).sort((e,o)=>{let i=0;const f=/^Quarter\s*(\d+)/i,h=e.match(f),C=o.match(f);if(h&&C){const A=parseInt(h[1]),b=parseInt(C[1]);i=A-b}else if(h||C)i=h?-1:1;else{const A=v.findIndex(S=>S.toLowerCase()===e.toLowerCase()),b=v.findIndex(S=>S.toLowerCase()===o.toLowerCase());A!==-1&&b!==-1?i=A-b:i=e.localeCompare(o)}return n?i:-i});let p="";d.forEach(e=>{const o=l[e].sort((i,f)=>new Date(f.pdfDate)-new Date(i.pdfDate));p+=`  
                                <div class="subAccordianContent" style="display: nona;">
                                    <div class="publicDisclosuresWrap">
                                        <div class="innersubAccordianContent">
                                            <a href="javascript:;" class="innersubAccordianTitle">${e}</a>
                                            <div class="publicDisclosuresWrap innerSubAccordianData" style="display: none;" >
                                                <ul> ${D(o,`
                                                    <div class="forName">    
                                                        <li data-date="{pdfDate}">
                                                            <a href="{PdfPath}" data-category="{Pdf_Category}" target="_blank">
                                                                <span class="created-date">{Created_Date}</span>
                                                                {Title}</a>
                                                        </li>
                                                    </div>
                                                    `)} 
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `}),r.innerHTML+=`
                        <section class="accordianpdf-section">
                            <div class="container boxContainer">
                                <div class="accordianContent">
                                    <div class="accordianBox">
                                        <div class="subAccordianWrap">
                                            <div class="subAccordianBox">
                                                <a href="javascript:;" class="subAccordianTitle"
                                                    data-accordianpdf-folderpath="/content/dam/piramalfinance/pdf/stakeholder/financial-reports/2024"
                                                    data-accordianpdf-folderdepth="2">${t}</a>
                                                    <div class="grey-border" style="display: none;">
                                                ${p}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    `}),r.querySelectorAll(".subAccordianContent").forEach(t=>{t.style.display="none"}),r.querySelectorAll(".subAccordianTitle").forEach(t=>{t.addEventListener("click",E)}),r.querySelectorAll(".innersubAccordianTitle").forEach(t=>{t.addEventListener("click",handleInnerAccordionClick)})}catch(s){console.error(s)}}export function handleInnerAccordionClick(r){const a=r.target.parentNode;a.closest(".grey-border").querySelectorAll(".subAccordianContent").forEach(n=>{r.target.closest(".subAccordianContent")===n||(n.querySelectorAll(".innersubAccordianContent").forEach(s=>{s.classList.remove("active")}),n.querySelectorAll(".innerSubAccordianData").forEach(s=>{s.style.display="none"}))});const c=getSiblings(a);a.classList.toggle("active"),c.forEach(n=>{n.classList.remove("active")});const g=a.querySelector(".innerSubAccordianData"),m=window.getComputedStyle(g);g.style.display=m.getPropertyValue("display")==="none"?"block":"none",c.forEach(n=>{const s=n.querySelector(".innerSubAccordianData");window.getComputedStyle(s).getPropertyValue("display")==="block"&&(s.style.display="none")});try{const n={};n.click_text=r.target.textContent.trim(),n.cta_position=r.target.closest(".section").querySelector(".default-content-wrapper").querySelector("h1, h2, h3, h4, h5, h6").textContent.trim(),q(n)}catch(n){console.warn(n)}}export function getSiblings(r){const a=[];let c=r.parentNode.firstChild;for(;c;c=c.nextSibling)c.nodeType===1&&c!==r&&a.push(c);return a}
