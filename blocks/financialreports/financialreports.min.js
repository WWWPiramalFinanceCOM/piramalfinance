import{ctaClickInteraction as S}from"../../dl.min.js";import{fetchAPI as E,getProps as q,renderHelper as x}from"../../scripts/common.min.js";export default async function L(n){const s=q(n),[a,h,A]=s,r=A==="ascending";if(n.innerHTML="",!a){console.error("API URL is required for financialreports block");return}try{let w=function(t){n.querySelectorAll(".subAccordianBox").forEach(e=>{t.target.parentElement.classList.contains("active")||(e.classList.remove("active"),e.querySelectorAll(".subAccordianContent,.grey-border").forEach(o=>{o.style.display="none"}))});const l=t.target.parentNode,d=getSiblings(l);l.classList.toggle("active"),d.forEach(e=>{e.classList.remove("active")}),l.querySelectorAll(".subAccordianContent").forEach(e=>{const o=window.getComputedStyle(e);e.parentElement.style.display=o.getPropertyValue("display")==="none"?"block":"none",e.style.display=o.getPropertyValue("display")==="none"?"block":"none"}),d.forEach(e=>{const o=e.querySelector(".subAccordianContent");window.getComputedStyle(o).getPropertyValue("display")==="block"&&(o.style.display="none")});try{const e={};e.click_text=t.target.textContent.trim(),e.cta_position=t.target.closest(".section").querySelector(".default-content-wrapper").querySelector("h1, h2, h3, h4, h5, h6").textContent.trim(),S(e)}catch(e){console.warn(e)}};const p=await(await E("GET",a)).json(),y=p.result&&Array.isArray(p.result)?p.result[0]:p,v=Object.keys(y).sort((t,l)=>{const d=parseInt(t.split("-")[0]),u=parseInt(l.split("-")[0]);return r?d-u:u-d}),g=["January","February","March","April","May","June","July","August","September","October","November","December"],C=["Quarter 1","Quarter 2","Quarter 3","Quarter 4"];v.forEach(t=>{const l=Array.isArray(y[t])?y[t][0]:y[t],d=Object.keys(l).sort((e,o)=>{let i=0;if(e.startsWith("Quarter")&&o.startsWith("Quarter"))return i=C.indexOf(e)-C.indexOf(o),i;{const f=g.findIndex(b=>b.toLowerCase()===e.toLowerCase()),m=g.findIndex(b=>b.toLowerCase()===o.toLowerCase());f!==-1&&m!==-1?i=f-m:i=e.localeCompare(o)}return r?i:-i});let u="";d.forEach(e=>{const o=l[e].sort((i,f)=>new Date(f.pdfDate)-new Date(i.pdfDate));u+=`  
                                <div class="subAccordianContent" style="display: nona;">
                                    <div class="publicDisclosuresWrap">
                                        <div class="innersubAccordianContent">
                                            <a href="javascript:;" class="innersubAccordianTitle">${e}</a>
                                            <div class="publicDisclosuresWrap innerSubAccordianData" style="display: none;" >
                                                <ul> ${x(o,`
                                                    <div class="forName">    
                                                        <li data-date="{pdfDate}">
                                                            <a href="{PdfPath}" data-category="{Pdf_Category}" target="_blank">
                                                                <span class="created-date">{Created_Date}</span>
                                                                {Title}</a>
                                                        </li>
                                                    </div>
                                                    `)} 
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `}),n.innerHTML+=`
                        <section class="accordianpdf-section">
                            <div class="container boxContainer">
                                <div class="accordianContent">
                                    <div class="accordianBox">
                                        <div class="subAccordianWrap">
                                            <div class="subAccordianBox">
                                                <a href="javascript:;" class="subAccordianTitle"
                                                    data-accordianpdf-folderpath="/content/dam/piramalfinance/pdf/stakeholder/financial-reports/2024"
                                                    data-accordianpdf-folderdepth="2">${t}</a>
                                                    <div class="grey-border" style="display: none;">
                                                ${u}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    `}),n.querySelectorAll(".subAccordianContent").forEach(t=>{t.style.display="none"}),n.querySelectorAll(".subAccordianTitle").forEach(t=>{t.addEventListener("click",w)}),n.querySelectorAll(".innersubAccordianTitle").forEach(t=>{t.addEventListener("click",handleInnerAccordionClick)})}catch(c){console.error(c)}}export function handleInnerAccordionClick(n){const s=n.target.parentNode;s.closest(".grey-border").querySelectorAll(".subAccordianContent").forEach(r=>{n.target.closest(".subAccordianContent")===r||(r.querySelectorAll(".innersubAccordianContent").forEach(c=>{c.classList.remove("active")}),r.querySelectorAll(".innerSubAccordianData").forEach(c=>{c.style.display="none"}))});const a=getSiblings(s);s.classList.toggle("active"),a.forEach(r=>{r.classList.remove("active")});const h=s.querySelector(".innerSubAccordianData"),A=window.getComputedStyle(h);h.style.display=A.getPropertyValue("display")==="none"?"block":"none",a.forEach(r=>{const c=r.querySelector(".innerSubAccordianData");window.getComputedStyle(c).getPropertyValue("display")==="block"&&(c.style.display="none")});try{const r={};r.click_text=n.target.textContent.trim(),r.cta_position=n.target.closest(".section").querySelector(".default-content-wrapper").querySelector("h1, h2, h3, h4, h5, h6").textContent.trim(),S(r)}catch(r){console.warn(r)}}export function getSiblings(n){const s=[];let a=n.parentNode.firstChild;for(;a;a=a.nextSibling)a.nodeType===1&&a!==n&&s.push(a);return s}
