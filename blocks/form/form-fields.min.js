import{toClassName as b}from"../../scripts/aem.js";import{toBase64 as h}from"./base-64.js";function o(e){const t=document.createElement("div");return e.Style&&(t.className=e.Style),t.classList.add("field-wrapper",`${e.Type}-wrapper`),t.dataset.fieldset=e.Fieldset,t}const l=[];function m(e,t=""){const a=b(`form-${e.Name}${t}`);l[a]=l[a]||0;const n=l[a]?`-${l[a]}`:"";return l[a]+=1,`${a}${n}`}function u(e){const t=document.createElement("label");return t.id=m(e,"-label"),t.textContent=e.Label||e.Name,t.setAttribute("for",e.Id),(e.Mandatory.toLowerCase()==="true"||e.Mandatory.toLowerCase()==="x")&&(t.dataset.required=!0),t}function i(e,t){e.id=t.Id,e.name=t.Name,e.required=t.Mandatory&&(t.Mandatory.toLowerCase()==="true"||t.Mandatory.toLowerCase()==="x"),e.placeholder=t.Placeholder,e.value=t.Value}const L=e=>{const t=o(e),a=e.Style&&e.Style.includes("sub-heading")?3:2,n=document.createElement(`h${a}`);return n.textContent=e.Value||e.Label,n.id=e.Id,t.append(n),{field:n,fieldWrapper:t}},x=e=>{const t=o(e),a=document.createElement("p");return a.textContent=e.Value||e.Label,a.id=e.Id,t.append(a),{field:a,fieldWrapper:t}},y=async e=>{const t=document.createElement("select");i(t,e);const a=({text:r,value:c})=>{const s=document.createElement("option");return s.text=r.trim(),s.value=c.trim(),s.value===t.value&&s.setAttribute("selected",""),t.add(s),s};if(e.Placeholder&&a({text:e.Placeholder,value:""}).setAttribute("disabled",""),e.Options){let r=[];if(e.Options.startsWith("https://")){const c=new URL(e.Options);(await(await fetch(`${c.pathname}${c.search}`)).json()).data.forEach(d=>{r.push({text:d.Option,value:d.Value||d.Option})})}else r=e.Options.split(",").map(c=>({text:c.trim(),value:c.trim().toLowerCase()}));r.forEach(c=>a(c))}const n=o(e);return n.append(t),n.prepend(u(e)),{field:t,fieldWrapper:n}},E=(e,t)=>(t.dataset.confirmation=new URL(e.Value).pathname,{}),w=e=>{const t=document.createElement("button");t.textContent=e.Label||e.Name,t.classList.add("button"),t.type="submit";const a=o(e);return a.append(t),{field:t,fieldWrapper:a}},v=e=>{const t=document.createElement("textarea");i(t,e);const a=o(e),n=u(e);return t.setAttribute("aria-labelledby",n.id),a.append(t),a.prepend(n),{field:t,fieldWrapper:a}},p=e=>{const t=document.createElement("input");t.type=e.Type,i(t,e);const a=o(e),n=u(e);return t.setAttribute("aria-labelledby",n.id),a.append(t),e.Type==="radio"||e.Type==="checkbox"?a.append(n):a.prepend(n),t.addEventListener("change",async function(r){const c=await h(this.files[0]);this.dataset.fileData=c}),{field:t,fieldWrapper:a}},g=e=>{const t=document.createElement("fieldset");if(i(t,e),e.Label){const n=document.createElement("legend");n.textContent=e.Label,t.append(n)}const a=o(e);return a.append(t),{field:t,fieldWrapper:a}},C=e=>{const{field:t,fieldWrapper:a}=p(e);t.type="checkbox",t.value||(t.value="on"),t.classList.add("toggle"),a.classList.add("selection-wrapper");const n=document.createElement("div");n.classList.add("switch"),n.append(t),a.append(n);const r=document.createElement("span");return r.classList.add("slider"),n.append(r),r.addEventListener("click",()=>{t.checked=!t.checked}),{field:t,fieldWrapper:a}},W=e=>{const{field:t,fieldWrapper:a}=p(e);return t.value||(t.value="checked"),a.classList.add("selection-wrapper"),{field:t,fieldWrapper:a}},F=e=>{const{field:t,fieldWrapper:a}=p(e);return t.value||(t.value=e.Label||"on"),a.classList.add("selection-wrapper"),{field:t,fieldWrapper:a}},I={select:y,heading:L,plaintext:x,"text-area":v,toggle:C,submit:w,confirmation:E,fieldset:g,checkbox:W,radio:F};export default async function f(e,t){e.Id=e.Id||m(e);const a=e.Type.toLowerCase();return(await(I[a]||p)(e,t)).fieldWrapper}
