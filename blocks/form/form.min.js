import"./base-64.min.js";import u from"./form-fields.min.js";async function d(e,a){const{pathname:t}=new URL(e),o=await(await fetch(t)).json(),n=document.createElement("form");return n.dataset.action=a,(await Promise.all(o.data.map(s=>u(s,n)))).forEach(s=>{s&&n.append(s)}),n.querySelectorAll("fieldset").forEach(s=>{n.querySelectorAll(`[data-fieldset="${s.name}"`).forEach(l=>{s.append(l)})}),n}function m(e){const a={};return[...e.elements].forEach(t=>{t.name&&t.type!=="submit"&&!t.disabled&&(t.type==="radio"?t.checked&&(a[t.name]=t.value):t.type==="file"?a[t.name]=t.dataset.fileData:t.type==="checkbox"?t.checked&&(a[t.name]=a[t.name]?`${a[t.name]},${t.value}`:t.value):a[t.name]=t.value)}),a}async function p(e){if(e.getAttribute("data-submitting")==="true")return;const a=e.querySelector('button[type="submit"]');try{e.setAttribute("data-submitting","true"),a.disabled=!0;const t=m(e),i=await fetch(e.dataset.action,{method:"POST",body:JSON.stringify({data:t}),headers:{"Content-Type":"application/json"}});if(i.ok)e.dataset.confirmation&&(window.location.href=e.dataset.confirmation);else{const o=await i.text();throw new Error(o)}}catch(t){console.error(t)}finally{e.setAttribute("data-submitting","false"),a.disabled=!1}}export default async function f(e){const a=[...e.querySelectorAll("a")].map(n=>n.innerText),t=a.find(n=>n.startsWith(window.location.origin)&&n.endsWith(".json")),i=a.find(n=>n!==t),o=await d(t,i);e.replaceChildren(o),o.addEventListener("submit",n=>{if(n.preventDefault(),o.checkValidity())p(o);else{const r=o.querySelector(":invalid:not(fieldset)");r&&(r.focus(),r.scrollIntoView({behavior:"smooth"}))}})}
