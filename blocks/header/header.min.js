import{headerInteraction as w,navlogin as O}from"../../dl.min.js";import{autoLinkLangPath as B,fetchPlaceholders as F,getMetadata as y}from"../../scripts/aem.min.js";import{targetObject as p}from"../../scripts/scripts.min.js";import{body as N}from"../../scripts/common.min.js";import{loadFragment as k}from"../fragment/fragment.min.js";const m=window.matchMedia("(min-width: 1201px)"),P=a=>{const r=document.createElement("p");window.isEditor&&(a.firstElementChild.tagName!=="P"&&(r.append(...[...a.childNodes].filter(e=>e.tagName!=="UL")),a.prepend(r)),a.querySelectorAll(":scope > ul > li:not(:has( > a))").forEach(e=>{const t=e.firstChild,l=e.firstChild.nextSibling,n=document.createElement("p");e.childNodes.length===3?(n.append(t,l),e.prepend(n)):e.lastElementChild&&e.lastElementChild.tagName!=="UL"&&e.lastElementChild.tagName!=="P"?(n.append(...e.childNodes),e.prepend(n)):e.lastElementChild&&e.lastElementChild.tagName==="UL"&&(n.append(...[...e.childNodes].filter(c=>c.tagName!=="UL")),e.prepend(n))}))};function H(a){if(a.code==="Escape"){const r=document.getElementById("nav"),e=r.querySelector(".nav-sections"),t=e.querySelector('[aria-expanded="true"]');t&&m.matches?(toggleAllNavSections(e),t.focus()):m.matches||(E(r,e),r.querySelector("button").focus())}}function U(a){const r=document.activeElement;if(r.className==="nav-drop"&&(a.code==="Enter"||a.code==="Space")){const t=r.getAttribute("aria-expanded")==="true";toggleAllNavSections(r.closest(".nav-sections")),r.setAttribute("aria-expanded",t?"false":"true")}}function T(){document.activeElement.addEventListener("keydown",U)}export function toggleAllNavSections(a,r=!1){a?.querySelectorAll(".nav-sections .default-content-wrapper > ul > li").forEach(e=>{e.setAttribute("aria-expanded",r)})}function E(a,r,e=null){const t=e!==null?!e:a.getAttribute("aria-expanded")==="true",l=a.querySelector(".nav-hamburger button");document.body.style.overflowY=t||m.matches?"":"hidden",a.setAttribute("aria-expanded",t?"false":"true"),toggleAllNavSections(r,t||m.matches?"false":"true"),l.setAttribute("aria-label",t?"Open navigation":"Close navigation");const n=r?.querySelectorAll(".nav-drop");m.matches?n?.forEach(c=>{c.hasAttribute("tabindex")||(c.setAttribute("role","button"),c.setAttribute("tabindex",0),c.addEventListener("focus",T))}):n?.forEach(c=>{c.removeAttribute("role"),c.removeAttribute("tabindex"),c.removeEventListener("focus",T)}),!t||m.matches?window.addEventListener("keydown",H):window.removeEventListener("keydown",H)}function I(a){const r=a.querySelector(":scope > :where(a,p)");return r?r.textContent.trim():Array.from(a.childNodes).filter(e=>e.nodeType===Node.TEXT_NODE).map(e=>e.textContent).join(" ")}async function j(a,r){const e=[],t=document.querySelector(".nav-brand a").href;let l=Array.from(a.querySelectorAll("a")).find(d=>d.href===r);if(l)do{const d=l.querySelector(":scope > a");e.unshift({title:I(l),url:d?d.href:null}),l=l.closest("ul")?.closest("li")}while(l);else r!==t&&e.unshift({title:y("og:title"),url:r});const c=(await F()).breadcrumbsHomeLabel||"Home";return e.unshift({title:c,url:t}),e.length>1&&(e[e.length-1].url=null),e[e.length-1]["aria-current"]="page",e}async function W(){const a=document.createElement("nav");a.className="breadcrumbs";const r=await j(document.querySelector(".nav-sections"),document.location.href),e=document.createElement("ol");return e.append(...r.map(t=>{const l=document.createElement("li");if(t["aria-current"]&&l.setAttribute("aria-current",t["aria-current"]),t.url){const n=document.createElement("a");n.href=t.url,n.textContent=t.title,l.append(n)}else l.textContent=t.title;return l})),a.append(e),a}export default async function $(a){const r=y("nav")||"/nav";r.endsWith("/nav-1")&&document.querySelector("header").classList.add("primary");const e=await k(r);a.classList.add("dp-none");const t=document.createElement("nav");for(t.id="nav";e.firstElementChild;)t.append(e.firstElementChild);r.includes("/neeyat/")&&(a.classList.remove("header"),a.classList.add("header-neeyat-nav")),["brand","sections","tools"].forEach((g,o)=>{const i=t.children[o];i&&i.classList.add(`nav-${g}`)});const n=t.querySelector(".nav-brand"),c=t.querySelector(".nav-tools"),d=document.createElement("a"),_=n.querySelector("picture");d.append(_),d.setAttribute("href","/"),n.append(d),B(d),n.replaceChild(d,n.firstElementChild);let x=!0;const u=t.querySelector(".nav-sections");if(u){let g=u.querySelectorAll(":scope .default-content-wrapper > ul > li").length-1;g=u.querySelectorAll(":scope .default-content-wrapper > ul > li")[g],g.addEventListener("click",o=>{O(p.pageName),x=!1}),u.querySelectorAll(":scope .default-content-wrapper > ul > li").forEach(o=>{P(o),o.querySelector("ul")&&o.classList.add("nav-drop"),o.addEventListener("click",i=>{if(m.matches){if(x)try{let f="";i.target.tagName=="IMG"||i.target.querySelector("icon-language")?f=i.target.getAttribute("data-icon-name"):f=i.target.textContent.trim();const h=i.target.closest("ul").closest("li")?.querySelector("p")?.innerText||"";p.ctaPosition="Top Menu Bar",w(f,h,p.ctaPosition,p.pageName)}catch(f){console.warn(f)}x=!0;const s=o.getAttribute("aria-expanded")==="true";toggleAllNavSections(u),o.classList.contains("nav-drop")?(o.setAttribute("aria-expanded",s?"false":"true"),u.setAttribute("aria-expanded",s?"false":"true"),s?N.classList.remove("modal-open"):N.classList.add("modal-open")):(N.classList.remove("modal-open"),o.setAttribute("aria-expanded","false"),u.setAttribute("aria-expanded","false"))}})}),u.querySelectorAll(".button-container").forEach(o=>{o.classList.remove("button-container"),o.querySelector(".button").classList.remove("button")})}const v=document.createElement("div");v.classList.add("nav-hamburger"),v.innerHTML=`<button type="button" aria-controls="nav" aria-label="Open navigation">
      <span class="nav-hamburger-icon"></span>
    </button>`;let L=null;v.addEventListener("click",async g=>{if(!L){L=await k(y("mobilenav"));const o=L.querySelector(".default-content-wrapper");o.classList.add("desk-dp-none"),n.prepend(o),o.querySelectorAll(":scope > ul > li").forEach(i=>{P(i)}),o.querySelectorAll("ul ul").forEach(i=>{i.querySelectorAll("ul p").forEach(s=>{s.addEventListener("click",f=>{try{const h=f.target.textContent.trim(),A=f.target.closest("li ul").parentNode.querySelector("p").textContent.trim();p.ctaPosition="Hamburger",w(h,A,p.ctaPosition,p.pageName)}catch(h){console.warn(h)}})}),i.querySelectorAll("ul").forEach(s=>{s.setAttribute("aria-expanded","false"),s.parentElement.querySelector("p").addEventListener("click",f=>{const h=s.getAttribute("aria-expanded")==="true";h?s.style.maxHeight="0px":s.style.maxHeight=`${s.scrollHeight}px`,s.setAttribute("aria-expanded",h?"false":"true"),s.parentElement.setAttribute("aria-expanded",h?"false":"true"),s.parentElement.querySelector("p").classList.toggle("navlist-dropdown"),s.querySelectorAll("ul > li > a").forEach(A=>{A.addEventListener("click",S=>{try{const q=S.target.textContent.trim(),M=S.target?.closest("ul")?.parentNode?.querySelector(".navlist-dropdown")?.textContent.trim()||"";p.ctaPosition="Hamburger",w(q,M,p.ctaPosition,p.pageName)}catch(q){console.warn(q)}})})})})})}E(t,u)}),t.prepend(v),t.setAttribute("aria-expanded","false"),E(t,u,m.matches),m.addEventListener("change",()=>E(t,u,m.matches));const b=document.createElement("div");b.className="nav-wrapper",b.append(t),a.append(b),y("breadcrumbs").toLowerCase()==="true"&&b.append(await W());const D=document.querySelector(".nav-sections .default-content-wrapper"),C=d.cloneNode(!0);C.classList.add("mobile-logo"),D?.prepend(C),a.classList.remove("dp-none");try{y("category-type")==="retails-finance"?c.querySelectorAll("li")[0].classList.add("active"):c.querySelectorAll("li")[1].classList.add("active")}catch(g){console.warn(g)}}
