import{headerInteraction as x,navlogin as D}from"../../dl.min.js";import{autoLinkLangPath as O,fetchPlaceholders as F,getMetadata as v}from"../../scripts/aem.min.js";import{targetObject as u}from"../../scripts/scripts.min.js";import{body as C}from"../../scripts/common.min.js";import{loadFragment as k}from"../fragment/fragment.min.js";const m=window.matchMedia("(min-width: 1201px)"),P=a=>{const r=document.createElement("p");window.isEditor&&(a.firstElementChild.tagName!=="P"&&(r.append(...[...a.childNodes].filter(e=>e.tagName!=="UL")),a.prepend(r)),a.querySelectorAll(":scope > ul > li:not(:has( > a))").forEach(e=>{const t=e.firstChild,c=e.firstChild.nextSibling,s=document.createElement("p");e.childNodes.length===3?(s.append(t,c),e.prepend(s)):e.lastElementChild&&e.lastElementChild.tagName!=="UL"&&e.lastElementChild.tagName!=="P"?(s.append(...e.childNodes),e.prepend(s)):e.lastElementChild&&e.lastElementChild.tagName==="UL"&&(s.append(...[...e.childNodes].filter(i=>i.tagName!=="UL")),e.prepend(s))}))};function T(a){if(a.code==="Escape"){const r=document.getElementById("nav"),e=r.querySelector(".nav-sections"),t=e.querySelector('[aria-expanded="true"]');t&&m.matches?(toggleAllNavSections(e),t.focus()):m.matches||(L(r,e),r.querySelector("button").focus())}}function I(a){const r=document.activeElement;if(r.className==="nav-drop"&&(a.code==="Enter"||a.code==="Space")){const t=r.getAttribute("aria-expanded")==="true";toggleAllNavSections(r.closest(".nav-sections")),r.setAttribute("aria-expanded",t?"false":"true")}}function _(){document.activeElement.addEventListener("keydown",I)}export function toggleAllNavSections(a,r=!1){a?.querySelectorAll(".nav-sections .default-content-wrapper > ul > li").forEach(e=>{e.setAttribute("aria-expanded",r)})}function L(a,r,e=null){const t=e!==null?!e:a.getAttribute("aria-expanded")==="true",c=a.querySelector(".nav-hamburger button");document.body.style.overflowY=t||m.matches?"":"hidden",a.setAttribute("aria-expanded",t?"false":"true"),toggleAllNavSections(r,t||m.matches?"false":"true"),c.setAttribute("aria-label",t?"Open navigation":"Close navigation");const s=r?.querySelectorAll(".nav-drop");m.matches?s?.forEach(i=>{i.hasAttribute("tabindex")||(i.setAttribute("role","button"),i.setAttribute("tabindex",0),i.addEventListener("focus",_))}):s?.forEach(i=>{i.removeAttribute("role"),i.removeAttribute("tabindex"),i.removeEventListener("focus",_)}),!t||m.matches?window.addEventListener("keydown",T):window.removeEventListener("keydown",T)}function U(a){const r=a.querySelector(":scope > :where(a,p)");return r?r.textContent.trim():Array.from(a.childNodes).filter(e=>e.nodeType===Node.TEXT_NODE).map(e=>e.textContent).join(" ")}async function $(a,r){const e=[],t=document.querySelector(".nav-brand a").href;let c=Array.from(a.querySelectorAll("a")).find(f=>f.href===r);if(c)do{const f=c.querySelector(":scope > a");e.unshift({title:U(c),url:f?f.href:null}),c=c.closest("ul")?.closest("li")}while(c);else r!==t&&e.unshift({title:v("og:title"),url:r});const i=(await F()).breadcrumbsHomeLabel||"Home";return e.unshift({title:i,url:t}),e.length>1&&(e[e.length-1].url=null),e[e.length-1]["aria-current"]="page",e}async function j(){const a=document.createElement("nav");a.className="breadcrumbs";const r=await $(document.querySelector(".nav-sections"),document.location.href),e=document.createElement("ol");return e.append(...r.map(t=>{const c=document.createElement("li");if(t["aria-current"]&&c.setAttribute("aria-current",t["aria-current"]),t.url){const s=document.createElement("a");s.href=t.url,s.textContent=t.title,c.append(s)}else c.textContent=t.title;return c})),a.append(e),a}export default async function G(a){const r=v("nav")||"/nav";r.endsWith("/nav-1")&&document.querySelector("header").classList.add("primary");const e=await k(r);a.classList.add("dp-none");const t=document.createElement("nav");for(t.id="nav";e.firstElementChild;)t.append(e.firstElementChild);r.includes("/neeyat/")&&(a.classList.remove("header"),a.classList.add("header-neeyat-nav")),["brand","sections","tools"].forEach((d,o)=>{const l=t.children[o];l&&l.classList.add(`nav-${d}`)});const s=t.querySelector(".nav-brand"),i=t.querySelector(".nav-tools"),f=document.createElement("a"),H=s.querySelector("picture");f.append(H),f.setAttribute("href","/"),s.append(f),O(f),s.replaceChild(f,s.firstElementChild);let y=!0;const p=t.querySelector(".nav-sections");if(p){let d=p.querySelectorAll(":scope .default-content-wrapper > ul > li").length-1;d=p.querySelectorAll(":scope .default-content-wrapper > ul > li")[d],d.addEventListener("click",o=>{D(u.pageName),y=!1}),p.querySelectorAll(":scope .default-content-wrapper > ul > li:has(ul)").forEach(o=>{P(o),o.querySelector("ul")&&o.classList.add("nav-drop"),o.addEventListener("mouseenter",l=>{if(m.matches){if(y)try{let n="";l.target.tagName=="IMG"||l.target.querySelector("icon-language")?n=l.target.getAttribute("data-icon-name"):n=l.target.textContent.trim();const h=l.target.closest("ul").closest("li")?.querySelector("p")?.innerText||"";u.ctaPosition="Top Menu Bar",x(n,h,u.ctaPosition,u.pageName)}catch(n){console.warn(n)}y=!0,toggleAllNavSections(p),o.classList.contains("nav-drop")&&(o.setAttribute("aria-expanded","true"),p.setAttribute("aria-expanded","true"),C.classList.add("modal-open"))}}),o.addEventListener("mouseleave",l=>{if(m.matches){if(y)try{let n="";l.target.tagName=="IMG"||l.target.querySelector("icon-language")?n=l.target.getAttribute("data-icon-name"):n=l.target.textContent.trim();const h=l.target.closest("ul").closest("li")?.querySelector("p")?.innerText||"";u.ctaPosition="Top Menu Bar",x(n,h,u.ctaPosition,u.pageName)}catch(n){console.warn(n)}y=!0,o.classList.contains("nav-drop")&&(o.setAttribute("aria-expanded","false"),p.setAttribute("aria-expanded","false"),C.classList.remove("modal-open"))}})}),p.querySelectorAll(".button-container").forEach(o=>{o.classList.remove("button-container"),o.querySelector(".button").classList.remove("button")})}try{m.matches&&p.querySelectorAll(":scope .default-content-wrapper > ul >li:has(ul li)").forEach(d=>{if(d?.querySelector(":scope >ul >li >ul >li")){const o=d.querySelector("ul"),l=o.children.length;o.style.gridTemplateColumns=`repeat(${l}, minmax(0, 1fr))`}})}catch(d){console.log(d)}const E=document.createElement("div");E.classList.add("nav-hamburger"),E.innerHTML=`<button type="button" aria-controls="nav" aria-label="Open navigation">
      <span class="nav-hamburger-icon"></span>
    </button>`;let q=null;E.addEventListener("click",async d=>{if(!q){q=await k(v("mobilenav"));const o=q.querySelector(".default-content-wrapper");o.classList.add("desk-dp-none"),s.prepend(o),o.querySelectorAll(":scope > ul > li").forEach(l=>{P(l)}),o.querySelectorAll("ul ul").forEach(l=>{l.querySelectorAll("ul p").forEach(n=>{n.addEventListener("click",h=>{try{const g=h.target.textContent.trim(),A=h.target.closest("li ul").parentNode.querySelector("p").textContent.trim();u.ctaPosition="Hamburger",x(g,A,u.ctaPosition,u.pageName)}catch(g){console.warn(g)}})}),l.querySelectorAll("ul").forEach(n=>{n.setAttribute("aria-expanded","false"),n.parentElement.querySelector("p").addEventListener("click",h=>{const g=n.getAttribute("aria-expanded")==="true";g?n.style.maxHeight="0px":n.style.maxHeight=`${n.scrollHeight}px`,n.setAttribute("aria-expanded",g?"false":"true"),n.parentElement.setAttribute("aria-expanded",g?"false":"true"),n.parentElement.querySelector("p").classList.toggle("navlist-dropdown"),n.querySelectorAll("ul > li > a").forEach(A=>{A.addEventListener("click",S=>{try{const w=S.target.textContent.trim(),B=S.target?.closest("ul")?.parentNode?.querySelector(".navlist-dropdown")?.textContent.trim()||"";u.ctaPosition="Hamburger",x(w,B,u.ctaPosition,u.pageName)}catch(w){console.warn(w)}})})})})})}L(t,p)}),t.prepend(E),t.setAttribute("aria-expanded","false"),L(t,p,m.matches),m.addEventListener("change",()=>L(t,p,m.matches));const b=document.createElement("div");b.className="nav-wrapper",b.append(t),a.append(b),v("breadcrumbs").toLowerCase()==="true"&&b.append(await j());const M=document.querySelector(".nav-sections .default-content-wrapper"),N=f.cloneNode(!0);N.classList.add("mobile-logo"),M?.prepend(N),a.classList.remove("dp-none");try{v("category-type")==="retails-finance"?i.querySelectorAll("li")[0].classList.add("active"):i.querySelectorAll("li")[1].classList.add("active")}catch(d){console.warn(d)}}
