import{headerInteraction as x,navlogin as D}from"../../dl.min.js";import{autoLinkLangPath as O,fetchPlaceholders as F,getMetadata as v}from"../../scripts/aem.min.js";import{targetObject as d}from"../../scripts/scripts.min.js";import{body as S}from"../../scripts/common.min.js";import{loadFragment as k}from"../fragment/fragment.min.js";const m=window.matchMedia("(min-width: 1201px)"),P=a=>{const r=document.createElement("p");window.isEditor&&(a.firstElementChild.tagName!=="P"&&(r.append(...[...a.childNodes].filter(e=>e.tagName!=="UL")),a.prepend(r)),a.querySelectorAll(":scope > ul > li:not(:has( > a))").forEach(e=>{const t=e.firstChild,c=e.firstChild.nextSibling,o=document.createElement("p");e.childNodes.length===3?(o.append(t,c),e.prepend(o)):e.lastElementChild&&e.lastElementChild.tagName!=="UL"&&e.lastElementChild.tagName!=="P"?(o.append(...e.childNodes),e.prepend(o)):e.lastElementChild&&e.lastElementChild.tagName==="UL"&&(o.append(...[...e.childNodes].filter(i=>i.tagName!=="UL")),e.prepend(o))}))};function T(a){if(a.code==="Escape"){const r=document.getElementById("nav"),e=r.querySelector(".nav-sections"),t=e.querySelector('[aria-expanded="true"]');t&&m.matches?(toggleAllNavSections(e),t.focus()):m.matches||(L(r,e),r.querySelector("button").focus())}}function I(a){const r=document.activeElement;if(r.className==="nav-drop"&&(a.code==="Enter"||a.code==="Space")){const t=r.getAttribute("aria-expanded")==="true";toggleAllNavSections(r.closest(".nav-sections")),r.setAttribute("aria-expanded",t?"false":"true")}}function _(){document.activeElement.addEventListener("keydown",I)}export function toggleAllNavSections(a,r=!1){a?.querySelectorAll(".nav-sections .default-content-wrapper > ul > li").forEach(e=>{e.setAttribute("aria-expanded",r)})}function L(a,r,e=null){const t=e!==null?!e:a.getAttribute("aria-expanded")==="true",c=a.querySelector(".nav-hamburger button");document.body.style.overflowY=t||m.matches?"":"hidden",a.setAttribute("aria-expanded",t?"false":"true"),toggleAllNavSections(r,t||m.matches?"false":"true"),c.setAttribute("aria-label",t?"Open navigation":"Close navigation");const o=r?.querySelectorAll(".nav-drop");m.matches?o?.forEach(i=>{i.hasAttribute("tabindex")||(i.setAttribute("role","button"),i.setAttribute("tabindex",0),i.addEventListener("focus",_))}):o?.forEach(i=>{i.removeAttribute("role"),i.removeAttribute("tabindex"),i.removeEventListener("focus",_)}),!t||m.matches?window.addEventListener("keydown",T):window.removeEventListener("keydown",T)}function U(a){const r=a.querySelector(":scope > :where(a,p)");return r?r.textContent.trim():Array.from(a.childNodes).filter(e=>e.nodeType===Node.TEXT_NODE).map(e=>e.textContent).join(" ")}async function j(a,r){const e=[],t=document.querySelector(".nav-brand a").href;let c=Array.from(a.querySelectorAll("a")).find(u=>u.href===r);if(c)do{const u=c.querySelector(":scope > a");e.unshift({title:U(c),url:u?u.href:null}),c=c.closest("ul")?.closest("li")}while(c);else r!==t&&e.unshift({title:v("og:title"),url:r});const i=(await F()).breadcrumbsHomeLabel||"Home";return e.unshift({title:i,url:t}),e.length>1&&(e[e.length-1].url=null),e[e.length-1]["aria-current"]="page",e}async function G(){const a=document.createElement("nav");a.className="breadcrumbs";const r=await j(document.querySelector(".nav-sections"),document.location.href),e=document.createElement("ol");return e.append(...r.map(t=>{const c=document.createElement("li");if(t["aria-current"]&&c.setAttribute("aria-current",t["aria-current"]),t.url){const o=document.createElement("a");o.href=t.url,o.textContent=t.title,c.append(o)}else c.textContent=t.title;return c})),a.append(e),a}export default async function W(a){const r=v("nav")||"/nav";r.endsWith("/nav")&&document.querySelector("header").classList.add("primary");const e=await k(r);a.classList.add("dp-none");const t=document.createElement("nav");for(t.id="nav";e.firstElementChild;)t.append(e.firstElementChild);r.includes("/neeyat/")&&(a.classList.remove("header"),a.classList.add("header-neeyat-nav")),["brand","sections","tools"].forEach((f,l)=>{const s=t.children[l];s&&s.classList.add(`nav-${f}`)});const o=t.querySelector(".nav-brand"),i=t.querySelector(".nav-tools"),u=document.createElement("a"),H=o.querySelector("picture");u.append(H),u.setAttribute("href","/"),o.append(u),O(u),o.replaceChild(u,o.firstElementChild);let y=!0;const p=t.querySelector(".nav-sections");if(p){let f=p.querySelectorAll(":scope .default-content-wrapper > ul > li").length-1;f=p.querySelectorAll(":scope .default-content-wrapper > ul > li")[f],f.addEventListener("click",l=>{D(d.pageName),y=!1}),p.querySelectorAll(":scope .default-content-wrapper > ul > li:has(ul)").forEach(l=>{P(l),l.querySelector("ul")&&l.classList.add("nav-drop"),l.addEventListener("mouseenter",s=>{if(m.matches){if(y)try{let n="";s.target.tagName=="IMG"||s.target.querySelector("icon-language")?n=s.target.getAttribute("data-icon-name"):n=s.target.textContent.trim();const h=s.target.closest("ul").closest("li")?.querySelector("p")?.innerText||"";d.ctaPosition="Top Menu Bar",x(n,h,d.ctaPosition,d.pageName)}catch(n){console.warn(n)}y=!0,toggleAllNavSections(p),l.classList.contains("nav-drop")&&(l.setAttribute("aria-expanded","true"),p.setAttribute("aria-expanded","true"),S.classList.add("modal-open"))}}),l.addEventListener("mouseleave",s=>{if(m.matches){if(y)try{let n="";s.target.tagName=="IMG"||s.target.querySelector("icon-language")?n=s.target.getAttribute("data-icon-name"):n=s.target.textContent.trim();const h=s.target.closest("ul").closest("li")?.querySelector("p")?.innerText||"";d.ctaPosition="Top Menu Bar",x(n,h,d.ctaPosition,d.pageName)}catch(n){console.warn(n)}y=!0,l.classList.contains("nav-drop")&&(l.setAttribute("aria-expanded","false"),p.setAttribute("aria-expanded","false"),S.classList.remove("modal-open"))}})}),p.querySelectorAll(".button-container").forEach(l=>{l.classList.remove("button-container"),l.querySelector(".button").classList.remove("button")})}const E=document.createElement("div");E.classList.add("nav-hamburger"),E.innerHTML=`<button type="button" aria-controls="nav" aria-label="Open navigation">
      <span class="nav-hamburger-icon"></span>
    </button>`;let A=null;E.addEventListener("click",async f=>{if(!A){A=await k(v("mobilenav"));const l=A.querySelector(".default-content-wrapper");l.classList.add("desk-dp-none"),o.prepend(l),l.querySelectorAll(":scope > ul > li").forEach(s=>{P(s)}),l.querySelectorAll("ul ul").forEach(s=>{s.querySelectorAll("ul p").forEach(n=>{n.addEventListener("click",h=>{try{const g=h.target.textContent.trim(),q=h.target.closest("li ul").parentNode.querySelector("p").textContent.trim();d.ctaPosition="Hamburger",x(g,q,d.ctaPosition,d.pageName)}catch(g){console.warn(g)}})}),s.querySelectorAll("ul").forEach(n=>{n.setAttribute("aria-expanded","false"),n.parentElement.querySelector("p").addEventListener("click",h=>{const g=n.getAttribute("aria-expanded")==="true";g?n.style.maxHeight="0px":n.style.maxHeight=`${n.scrollHeight}px`,n.setAttribute("aria-expanded",g?"false":"true"),n.parentElement.setAttribute("aria-expanded",g?"false":"true"),n.parentElement.querySelector("p").classList.toggle("navlist-dropdown"),n.querySelectorAll("ul > li > a").forEach(q=>{q.addEventListener("click",C=>{try{const w=C.target.textContent.trim(),B=C.target?.closest("ul")?.parentNode?.querySelector(".navlist-dropdown")?.textContent.trim()||"";d.ctaPosition="Hamburger",x(w,B,d.ctaPosition,d.pageName)}catch(w){console.warn(w)}})})})})})}L(t,p)}),t.prepend(E),t.setAttribute("aria-expanded","false"),L(t,p,m.matches),m.addEventListener("change",()=>L(t,p,m.matches));const b=document.createElement("div");b.className="nav-wrapper",b.append(t),a.append(b),v("breadcrumbs").toLowerCase()==="true"&&b.append(await G());const M=document.querySelector(".nav-sections .default-content-wrapper"),N=u.cloneNode(!0);N.classList.add("mobile-logo"),M?.prepend(N),a.classList.remove("dp-none");try{v("category-type")==="retails-finance"?i.querySelectorAll("li")[0].classList.add("active"):i.querySelectorAll("li")[1].classList.add("active")}catch(f){console.warn(f)}}
