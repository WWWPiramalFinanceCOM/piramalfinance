import{headerInteraction as b,navlogin as B}from"../../dl.min.js";import{autoLinkLangPath as D,fetchPlaceholders as O,getMetadata as y}from"../../scripts/aem.min.js";import{targetObject as u}from"../../scripts/scripts.min.js";import{body as S}from"../../scripts/common.min.js";import{loadFragment as C}from"../fragment/fragment.min.js";const m=window.matchMedia("(min-width: 1201px)"),k=a=>{const r=document.createElement("p");window.isEditor&&(a.firstElementChild.tagName!=="P"&&(r.append(...[...a.childNodes].filter(e=>e.tagName!=="UL")),a.prepend(r)),a.querySelectorAll(":scope > ul > li:not(:has( > a))").forEach(e=>{const t=e.firstChild,c=e.firstChild.nextSibling,l=document.createElement("p");e.childNodes.length===3?(l.append(t,c),e.prepend(l)):e.lastElementChild&&e.lastElementChild.tagName!=="UL"&&e.lastElementChild.tagName!=="P"?(l.append(...e.childNodes),e.prepend(l)):e.lastElementChild&&e.lastElementChild.tagName==="UL"&&(l.append(...[...e.childNodes].filter(i=>i.tagName!=="UL")),e.prepend(l))}))};function P(a){if(a.code==="Escape"){const r=document.getElementById("nav"),e=r.querySelector(".nav-sections"),t=e.querySelector('[aria-expanded="true"]');t&&m.matches?(toggleAllNavSections(e),t.focus()):m.matches||(x(r,e),r.querySelector("button").focus())}}function F(a){const r=document.activeElement;if(r.className==="nav-drop"&&(a.code==="Enter"||a.code==="Space")){const t=r.getAttribute("aria-expanded")==="true";toggleAllNavSections(r.closest(".nav-sections")),r.setAttribute("aria-expanded",t?"false":"true")}}function T(){document.activeElement.addEventListener("keydown",F)}export function toggleAllNavSections(a,r=!1){a?.querySelectorAll(".nav-sections .default-content-wrapper > ul > li").forEach(e=>{e.setAttribute("aria-expanded",r)})}function x(a,r,e=null){const t=e!==null?!e:a.getAttribute("aria-expanded")==="true",c=a.querySelector(".nav-hamburger button");document.body.style.overflowY=t||m.matches?"":"hidden",a.setAttribute("aria-expanded",t?"false":"true"),toggleAllNavSections(r,t||m.matches?"false":"true"),c.setAttribute("aria-label",t?"Open navigation":"Close navigation");const l=r?.querySelectorAll(".nav-drop");m.matches?l?.forEach(i=>{i.hasAttribute("tabindex")||(i.setAttribute("role","button"),i.setAttribute("tabindex",0),i.addEventListener("focus",T))}):l?.forEach(i=>{i.removeAttribute("role"),i.removeAttribute("tabindex"),i.removeEventListener("focus",T)}),!t||m.matches?window.addEventListener("keydown",P):window.removeEventListener("keydown",P)}function I(a){const r=a.querySelector(":scope > :where(a,p)");return r?r.textContent.trim():Array.from(a.childNodes).filter(e=>e.nodeType===Node.TEXT_NODE).map(e=>e.textContent).join(" ")}async function U(a,r){const e=[],t=document.querySelector(".nav-brand a").href;let c=Array.from(a.querySelectorAll("a")).find(f=>f.href===r);if(c)do{const f=c.querySelector(":scope > a");e.unshift({title:I(c),url:f?f.href:null}),c=c.closest("ul")?.closest("li")}while(c);else r!==t&&e.unshift({title:y("og:title"),url:r});const i=(await O()).breadcrumbsHomeLabel||"Home";return e.unshift({title:i,url:t}),e.length>1&&(e[e.length-1].url=null),e[e.length-1]["aria-current"]="page",e}async function $(){const a=document.createElement("nav");a.className="breadcrumbs";const r=await U(document.querySelector(".nav-sections"),document.location.href),e=document.createElement("ol");return e.append(...r.map(t=>{const c=document.createElement("li");if(t["aria-current"]&&c.setAttribute("aria-current",t["aria-current"]),t.url){const l=document.createElement("a");l.href=t.url,l.textContent=t.title,c.append(l)}else c.textContent=t.title;return c})),a.append(e),a}export default async function j(a){const r=y("nav")||"/nav";r.endsWith("/nav-1")&&document.querySelector("header").classList.add("primary");const e=await C(r);a.classList.add("dp-none");const t=document.createElement("nav");for(t.id="nav";e.firstElementChild;)t.append(e.firstElementChild);r.includes("/neeyat/")&&(a.classList.remove("header"),a.classList.add("header-neeyat-nav")),["brand","sections","tools"].forEach((s,o)=>{const n=t.children[o];n&&n.classList.add(`nav-${s}`)});const l=t.querySelector(".nav-brand"),i=t.querySelector(".nav-tools"),f=document.createElement("a"),_=l.querySelector("picture");f.append(_),f.setAttribute("href","/"),l.append(f),D(f),l.replaceChild(f,l.firstElementChild);let g=!0;const p=t.querySelector(".nav-sections");if(p){let s=p.querySelectorAll(":scope .default-content-wrapper > ul > li").length-1;s=p.querySelectorAll(":scope .default-content-wrapper > ul > li")[s],s.addEventListener("click",()=>{B(u.pageName),g=!1}),p.querySelectorAll(":scope .default-content-wrapper > ul > li:has(ul)").forEach(o=>{k(o),o.querySelector("ul")&&o.classList.add("nav-drop"),o.addEventListener("mouseenter",n=>{if(m.matches){if(g)try{let d="";n.target.tagName=="IMG"||n.target.querySelector("icon-language")?d=n.target.getAttribute("data-icon-name"):d=n.target.textContent.trim();const h=n.target.closest("ul").closest("li")?.querySelector("p")?.innerText||"";u.ctaPosition="Top Menu Bar",b(d,h,u.ctaPosition,u.pageName)}catch(d){console.warn(d)}g=!0,toggleAllNavSections(p),o.classList.contains("nav-drop")&&(o.setAttribute("aria-expanded","true"),p.setAttribute("aria-expanded","true"),S.classList.add("modal-open"))}}),o.addEventListener("mouseleave",n=>{if(m.matches){if(g)try{let d="";n.target.tagName=="IMG"||n.target.querySelector("icon-language")?d=n.target.getAttribute("data-icon-name"):d=n.target.textContent.trim();const h=n.target.closest("ul").closest("li")?.querySelector("p")?.innerText||"";u.ctaPosition="Top Menu Bar",b(d,h,u.ctaPosition,u.pageName)}catch(d){console.warn(d)}g=!0,o.classList.contains("nav-drop")&&(o.setAttribute("aria-expanded","false"),p.setAttribute("aria-expanded","false"),S.classList.remove("modal-open"))}})}),p.querySelectorAll(".button-container").forEach(o=>{o.classList.remove("button-container"),o.querySelector(".button").classList.remove("button")})}try{m.matches&&p.querySelectorAll(":scope .default-content-wrapper > ul >li:has(ul li)").forEach(s=>{if(s?.querySelector(":scope >ul >li >ul >li")){const o=s.querySelector("ul"),n=o.children.length;o.style.gridTemplateColumns=`repeat(${n}, minmax(0, 1fr))`}})}catch(s){console.log(s)}const v=document.createElement("div");v.classList.add("nav-hamburger"),v.innerHTML=`<button type="button" aria-controls="nav" aria-label="Open navigation">
      <span class="nav-hamburger-icon"></span>
    </button>`;let L=null;v.addEventListener("click",async()=>{if(!L){L=await C(y("mobilenav"));const s=L.querySelector(".default-content-wrapper");s.classList.add("desk-dp-none"),l.prepend(s),s.querySelectorAll(":scope > ul > li").forEach(o=>{k(o)}),s.querySelectorAll("ul ul").forEach(o=>{o.querySelectorAll("ul p").forEach(n=>{n.addEventListener("click",d=>{try{const h=d.target.textContent.trim(),q=d.target.closest("li ul").parentNode.querySelector("p").textContent.trim();u.ctaPosition="Hamburger",b(h,q,u.ctaPosition,u.pageName)}catch(h){console.warn(h)}})}),o.querySelectorAll("ul").forEach(n=>{n.setAttribute("aria-expanded","false"),n.parentElement.querySelector("p").addEventListener("click",d=>{const h=n.getAttribute("aria-expanded")==="true";h?n.style.maxHeight="0px":n.style.maxHeight=`${n.scrollHeight}px`,n.setAttribute("aria-expanded",h?"false":"true"),n.parentElement.setAttribute("aria-expanded",h?"false":"true"),n.parentElement.querySelector("p").classList.toggle("navlist-dropdown"),n.querySelectorAll("ul > li > a").forEach(q=>{q.addEventListener("click",N=>{try{const A=N.target.textContent.trim(),M=N.target?.closest("ul")?.parentNode?.querySelector(".navlist-dropdown")?.textContent.trim()||"";u.ctaPosition="Hamburger",b(A,M,u.ctaPosition,u.pageName)}catch(A){console.warn(A)}})})})})})}x(t,p)}),t.prepend(v),t.setAttribute("aria-expanded","false"),x(t,p,m.matches),m.addEventListener("change",()=>x(t,p,m.matches));const E=document.createElement("div");E.className="nav-wrapper",E.append(t),a.append(E),y("breadcrumbs").toLowerCase()==="true"&&E.append(await $());const H=document.querySelector(".nav-sections .default-content-wrapper"),w=f.cloneNode(!0);w.classList.add("mobile-logo"),H?.prepend(w),a.classList.remove("dp-none");try{y("category-type")==="retails-finance"?i.querySelectorAll("li")[0].classList.add("active"):i.querySelectorAll("li")[1].classList.add("active")}catch(s){console.warn(s)}}
