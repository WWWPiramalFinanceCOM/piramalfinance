import{headerInteraction as q,navlogin as M}from"../../dl.js";import{fetchPlaceholders as O,getMetadata as b}from"../../scripts/aem.js";import{body as N,targetObject as u}from"../../scripts/scripts.js";import{loadFragment as k}from"../fragment/fragment.js";const p=window.matchMedia("(min-width: 1201px)"),P=a=>{const n=document.createElement("p");window.isEditor&&(a.firstElementChild.tagName!=="P"&&(n.append(...[...a.childNodes].filter(e=>e.tagName!=="UL")),a.prepend(n)),a.querySelectorAll(":scope > ul > li:not(:has( > a))").forEach(e=>{const t=e.firstChild,s=e.firstChild.nextSibling,r=document.createElement("p");e.childNodes.length===3?(r.append(t,s),e.prepend(r)):e.lastElementChild&&e.lastElementChild.tagName!=="UL"&&e.lastElementChild.tagName!=="P"?(r.append(...e.childNodes),e.prepend(r)):e.lastElementChild&&e.lastElementChild.tagName==="UL"&&(r.append(...[...e.childNodes].filter(l=>l.tagName!=="UL")),e.prepend(r))}))};function H(a){if(a.code==="Escape"){const n=document.getElementById("nav"),e=n.querySelector(".nav-sections"),t=e.querySelector('[aria-expanded="true"]');t&&p.matches?(toggleAllNavSections(e),t.focus()):p.matches||(E(n,e),n.querySelector("button").focus())}}function B(a){const n=document.activeElement;if(n.className==="nav-drop"&&(a.code==="Enter"||a.code==="Space")){const t=n.getAttribute("aria-expanded")==="true";toggleAllNavSections(n.closest(".nav-sections")),n.setAttribute("aria-expanded",t?"false":"true")}}function T(){document.activeElement.addEventListener("keydown",B)}export function toggleAllNavSections(a,n=!1){a?.querySelectorAll(".nav-sections .default-content-wrapper > ul > li").forEach(e=>{e.setAttribute("aria-expanded",n)})}function E(a,n,e=null){const t=e!==null?!e:a.getAttribute("aria-expanded")==="true",s=a.querySelector(".nav-hamburger button");document.body.style.overflowY=t||p.matches?"":"hidden",a.setAttribute("aria-expanded",t?"false":"true"),toggleAllNavSections(n,t||p.matches?"false":"true"),s.setAttribute("aria-label",t?"Open navigation":"Close navigation");const r=n?.querySelectorAll(".nav-drop");p.matches?r?.forEach(l=>{l.hasAttribute("tabindex")||(l.setAttribute("role","button"),l.setAttribute("tabindex",0),l.addEventListener("focus",T))}):r?.forEach(l=>{l.removeAttribute("role"),l.removeAttribute("tabindex"),l.removeEventListener("focus",T)}),!t||p.matches?window.addEventListener("keydown",H):window.removeEventListener("keydown",H)}function F(a){const n=a.querySelector(":scope > :where(a,p)");return n?n.textContent.trim():Array.from(a.childNodes).filter(e=>e.nodeType===Node.TEXT_NODE).map(e=>e.textContent).join(" ")}async function U(a,n){const e=[],t=document.querySelector(".nav-brand a").href;let s=Array.from(a.querySelectorAll("a")).find(h=>h.href===n);if(s)do{const h=s.querySelector(":scope > a");e.unshift({title:F(s),url:h?h.href:null}),s=s.closest("ul")?.closest("li")}while(s);else n!==t&&e.unshift({title:b("og:title"),url:n});const l=(await O()).breadcrumbsHomeLabel||"Home";return e.unshift({title:l,url:t}),e.length>1&&(e[e.length-1].url=null),e[e.length-1]["aria-current"]="page",e}async function I(){const a=document.createElement("nav");a.className="breadcrumbs";const n=await U(document.querySelector(".nav-sections"),document.location.href),e=document.createElement("ol");return e.append(...n.map(t=>{const s=document.createElement("li");if(t["aria-current"]&&s.setAttribute("aria-current",t["aria-current"]),t.url){const r=document.createElement("a");r.href=t.url,r.textContent=t.title,s.append(r)}else s.textContent=t.title;return s})),a.append(e),a}export default async function j(a){const n=b("nav")||"/nav",e=await k(n);a.classList.add("dp-none");const t=document.createElement("nav");for(t.id="nav";e.firstElementChild;)t.append(e.firstElementChild);n.includes("/neeyat/")&&(a.classList.remove("header"),a.classList.add("header-neeyat-nav")),["brand","sections","tools"].forEach((g,o)=>{const i=t.children[o];i&&i.classList.add(`nav-${g}`)});const r=t.querySelector(".nav-brand"),l=document.createElement("a"),h=r.querySelector("picture");l.append(h),l.setAttribute("href","/"),r.append(l),r.replaceChild(l,r.firstElementChild);let x=!0;const d=t.querySelector(".nav-sections");if(d){let g=d.querySelectorAll(":scope .default-content-wrapper > ul > li").length-1;g=d.querySelectorAll(":scope .default-content-wrapper > ul > li")[g],g.addEventListener("click",o=>{M(u.pageName),x=!1}),d.querySelectorAll(":scope .default-content-wrapper > ul > li").forEach(o=>{P(o),o.querySelector("ul")&&o.classList.add("nav-drop"),o.addEventListener("click",i=>{if(p.matches){if(x)try{let m="";i.target.tagName=="IMG"||i.target.querySelector("icon-language")?m=i.target.getAttribute("data-icon-name"):m=i.target.textContent.trim();const f=i.target.closest("ul").closest("li")?.querySelector("p")?.innerText||"";u.ctaPosition="Top Menu Bar",q(m,f,u.ctaPosition,u.pageName)}catch(m){console.warn(m)}x=!0;const c=o.getAttribute("aria-expanded")==="true";toggleAllNavSections(d),o.classList.contains("nav-drop")?(o.setAttribute("aria-expanded",c?"false":"true"),d.setAttribute("aria-expanded",c?"false":"true"),c?N.classList.remove("modal-open"):N.classList.add("modal-open")):(N.classList.remove("modal-open"),o.setAttribute("aria-expanded","false"),d.setAttribute("aria-expanded","false"))}})}),d.querySelectorAll(".button-container").forEach(o=>{o.classList.remove("button-container"),o.querySelector(".button").classList.remove("button")})}const v=document.createElement("div");v.classList.add("nav-hamburger"),v.innerHTML=`<button type="button" aria-controls="nav" aria-label="Open navigation">
      <span class="nav-hamburger-icon"></span>
    </button>`;let A=null;v.addEventListener("click",async g=>{if(!A){A=await k(b("mobilenav"));const o=A.querySelector(".default-content-wrapper");o.classList.add("desk-dp-none"),r.prepend(o),o.querySelectorAll(":scope > ul > li").forEach(i=>{P(i)}),o.querySelectorAll("ul ul").forEach(i=>{i.querySelectorAll("ul p").forEach(c=>{c.addEventListener("click",m=>{try{const f=m.target.textContent.trim(),L=m.target.closest("li ul").parentNode.querySelector("p").textContent.trim();u.ctaPosition="Hamburger",q(f,L,u.ctaPosition,u.pageName)}catch(f){console.warn(f)}})}),i.querySelectorAll("ul").forEach(c=>{c.setAttribute("aria-expanded","false"),c.parentElement.querySelector("p").addEventListener("click",m=>{const f=c.getAttribute("aria-expanded")==="true";f?c.style.maxHeight="0px":c.style.maxHeight=`${c.scrollHeight}px`,c.setAttribute("aria-expanded",f?"false":"true"),c.parentElement.setAttribute("aria-expanded",f?"false":"true"),c.parentElement.querySelector("p").classList.toggle("navlist-dropdown"),c.querySelectorAll("ul > li > a").forEach(L=>{L.addEventListener("click",S=>{try{const w=S.target.textContent.trim(),D=S.target?.closest("ul")?.parentNode?.querySelector(".navlist-dropdown")?.textContent.trim()||"";u.ctaPosition="Hamburger",q(w,D,u.ctaPosition,u.pageName)}catch(w){console.warn(w)}})})})})})}E(t,d)}),t.prepend(v),t.setAttribute("aria-expanded","false"),E(t,d,p.matches),p.addEventListener("change",()=>E(t,d,p.matches));const y=document.createElement("div");y.className="nav-wrapper",y.append(t),a.append(y),b("breadcrumbs").toLowerCase()==="true"&&y.append(await I());const _=document.querySelector(".nav-sections .default-content-wrapper"),C=l.cloneNode(!0);C.classList.add("mobile-logo"),_?.prepend(C),a.classList.remove("dp-none")}
