import{headerInteraction as w,loignClick as E,navlogin as L}from"../../dl.js";import{getMetadata as q}from"../../scripts/aem.js";import{targetObject as d}from"../../scripts/scripts.js";import{loadFragment as x}from"../fragment/fragment.js";const o=window.matchMedia("(min-width: 900px)"),S=window.matchMedia("(max-width: 768px)");function g(t){if(t.code==="Escape"){const e=document.getElementById("nav"),i=e.querySelector(".nav-sections"),a=i.querySelector('[aria-expanded="true"]');a&&o.matches?(toggleAllNavSections(i),a.focus()):o.matches||(f(e,i),e.querySelector("button").focus())}}function A(t){const e=document.activeElement;if(e.className==="nav-drop"&&(t.code==="Enter"||t.code==="Space")){const a=e.getAttribute("aria-expanded")==="true";toggleAllNavSections(e.closest(".nav-sections")),e.setAttribute("aria-expanded",a?"false":"true")}}function b(){document.activeElement.addEventListener("keydown",A)}export function toggleAllNavSections(t,e=!1){t?.querySelectorAll(".nav-sections .default-content-wrapper > ul > li").forEach(i=>{i.setAttribute("aria-expanded",e)})}function f(t,e,i=null){const a=i!==null?!i:t.getAttribute("aria-expanded")==="true";document.body.style.overflowY=a||o.matches?"":"hidden",t.setAttribute("aria-expanded",a?"false":"true"),toggleAllNavSections(e,a||o.matches?"false":"true");const r=e?.querySelectorAll(".nav-drop");o.matches?r?.forEach(s=>{s.hasAttribute("tabindex")||(s.setAttribute("tabindex",0),s.addEventListener("focus",b))}):r?.forEach(s=>{s.removeAttribute("role"),s.removeAttribute("tabindex"),s.removeEventListener("focus",b)}),!a||o.matches?window.addEventListener("keydown",g):window.removeEventListener("keydown",g)}export default async function k(t){const e=q("nav"),i=e?new URL(e,window.location).pathname:"/nav",a=await x(i);t.textContent="";const r=document.createElement("nav");for(r.id="nav";a.firstElementChild;)r.append(a.firstElementChild);["brand","sections","tools"].forEach((n,u)=>{const l=r.children[u];l&&l.classList.add(`nav-${n}`)});const m=r.querySelector(".nav-brand").querySelector(".button");m&&(m.className="",m.closest(".button-container").className="");const c=r.querySelector(".nav-sections");c&&c.querySelectorAll(":scope .default-content-wrapper > ul > li").forEach(n=>{n.querySelector("ul")&&n.classList.add("nav-drop"),n.addEventListener("click",u=>{if(o.matches&&!u.target.children.length){const l=n.getAttribute("aria-expanded")==="true";toggleAllNavSections(c),n.setAttribute("aria-expanded",l?"false":"true");try{const h=u.target.innerText,y=u.target.closest("ul").closest("li")?.querySelector("p")?.innerText;w(h,y,d.ctaPosition,d.pageName)}catch(h){console.warn(h)}}else if(S.matches){const l=n.getAttribute("aria-expanded")==="true";D(c),n.setAttribute("aria-expanded",l?"false":"true")}})});const v=document.createElement("div");v.classList.add("nav-hamburger"),v.innerHTML=`<div class="hambuger-menu" aria-controls="nav" aria-label="Open navigation">
    <div class="hamburger-image-custom">
        <img src="/content/dam/piramalfinance/header-images/icons8-hamburger-menu-100.png" alt="hamburger-icon">
    </div>
    <div class="cross-image-custom">
        <img src="/content/dam/piramalfinance/header-images/icons8-cross-100.png" alt="cross-icon">
    </div>
</div>`,r.prepend(v),r.querySelector(".hambuger-menu").addEventListener("click",function(){this.closest(".hambuger-menu").getAttribute("aria-label")=="Open navigation"?(d.ctaPosition="Hamburger",this.closest(".hambuger-menu").setAttribute("aria-label","Close navigation")):(d.ctaPosition="Top Menu Bar",this.closest(".hambuger-menu").setAttribute("aria-label","Open navigation")),C()}),r.setAttribute("aria-expanded","false"),f(r,c,o.matches),o.addEventListener("change",()=>f(r,c,o.matches));const p=document.createElement("div");p.className="nav-wrapper",p.append(r),t.append(p);try{N()}catch{}try{M()}catch{}try{t.querySelector(".nav-sections")&&(t.querySelector(".nav-sections").querySelector("ul").lastElementChild.querySelector("p").innerHTML='<img src="/content/dam/piramalfinance/header-images/language-black.svg" alt="language" class="leveloneimg">')}catch(n){console.warn(n)}try{t.querySelector(".nav-tools")?.addEventListener("click",n=>{E(n.target.innerText,d.pageName),L(d.pageName)})}catch(n){console.warn(n)}}function D(t,e=!1){t.querySelectorAll(".nav-sections .default-content-wrapper > ul > li").forEach(i=>{i.setAttribute("aria-expanded",e?"false":"true")})}function N(){document.querySelectorAll(".header-wrapper .section.nav-sections .default-content-wrapper ul:first-child > .nav-drop").forEach(e=>{e.addEventListener("click",function(i){document.querySelectorAll(".header-wrapper .section.nav-sections .default-content-wrapper ul:first-child > li").forEach(r=>r.classList.remove("navigation-level-active")),this.getAttribute("aria-expanded")=="true"?(this.closest(".default-content-wrapper").classList.add("active"),this.classList.add("navigation-level-active")):(this.closest(".default-content-wrapper").classList.remove("active"),this.classList.remove("navigation-level-active"))})})}function M(){document.querySelectorAll("#nav > div.section.mobile-view-header.page-container.code-container > div > div > div > div > ul > li").forEach(e=>{e.addEventListener("click",function(i){const a=e.querySelector("ul");a.style.display==="block"?(a.style.display="none",this.classList.remove("active")):(a.style.display="block",this.classList.add("active"))})})}function C(){document.querySelector(".nav-hamburger").querySelector("[aria-label]").ariaLabel.toLowerCase()=="close navigation"?(document.querySelector(".section.mobile-view-header").style.display="block",document.querySelector(".section.mobile-view-header").classList.add("mobile-slide-navigation")):document.querySelector(".nav-hamburger").querySelector("[aria-label]").ariaLabel.toLowerCase()=="open navigation"&&(document.querySelector(".section.mobile-view-header").style.display="none",document.querySelector(".section.mobile-view-header").classList.remove("mobile-slide-navigation"))}
