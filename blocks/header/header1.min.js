import{fetchPlaceholders as x,getMetadata as f}from"../../scripts/aem.min.js";import{loadFragment as y}from"../fragment/fragment.min.js";const d=window.matchMedia("(min-width: 1201px)");function E(n){if(n.code==="Escape"){const t=document.getElementById("nav"),e=t.querySelector(".nav-sections"),a=e.querySelector('[aria-expanded="true"]');a&&d.matches?(toggleAllNavSections(e),a.focus()):d.matches||(b(t,e),t.querySelector("button").focus())}}function g(n){const t=document.activeElement;if(t.className==="nav-drop"&&(n.code==="Enter"||n.code==="Space")){const a=t.getAttribute("aria-expanded")==="true";toggleAllNavSections(t.closest(".nav-sections")),t.setAttribute("aria-expanded",a?"false":"true")}}function A(){document.activeElement.addEventListener("keydown",g)}export function toggleAllNavSections(n,t=!1){n.querySelectorAll(".nav-sections .default-content-wrapper > ul > li").forEach(e=>{e.setAttribute("aria-expanded",t)})}function b(n,t,e=null){const a=e!==null?!e:n.getAttribute("aria-expanded")==="true",r=n.querySelector(".nav-hamburger button");document.body.style.overflowY=a||d.matches?"":"hidden",n.setAttribute("aria-expanded",a?"false":"true"),toggleAllNavSections(t,a||d.matches?"false":"true"),r.setAttribute("aria-label",a?"Open navigation":"Close navigation");const l=t.querySelectorAll(".nav-drop");d.matches?l.forEach(s=>{s.hasAttribute("tabindex")||(s.setAttribute("role","button"),s.setAttribute("tabindex",0),s.addEventListener("focus",A))}):l.forEach(s=>{s.removeAttribute("role"),s.removeAttribute("tabindex"),s.removeEventListener("focus",A)}),!a||d.matches?window.addEventListener("keydown",E):window.removeEventListener("keydown",E)}function w(n){const t=n.querySelector(":scope > :where(a,p)");return t?t.textContent.trim():Array.from(n.childNodes).filter(e=>e.nodeType===Node.TEXT_NODE).map(e=>e.textContent).join(" ")}async function L(n,t){const e=[],a=document.querySelector(".nav-brand a").href;let r=Array.from(n.querySelectorAll("a")).find(c=>c.href===t);if(r)do{const c=r.querySelector(":scope > a");e.unshift({title:w(r),url:c?c.href:null}),r=r.closest("ul")?.closest("li")}while(r);else t!==a&&e.unshift({title:f("og:title"),url:t});const s=(await x()).breadcrumbsHomeLabel||"Home";return e.unshift({title:s,url:a}),e.length>1&&(e[e.length-1].url=null),e[e.length-1]["aria-current"]="page",e}async function q(){const n=document.createElement("nav");n.className="breadcrumbs";const t=await L(document.querySelector(".nav-sections"),document.location.href),e=document.createElement("ol");return e.append(...t.map(a=>{const r=document.createElement("li");if(a["aria-current"]&&r.setAttribute("aria-current",a["aria-current"]),a.url){const l=document.createElement("a");l.href=a.url,l.textContent=a.title,r.append(l)}else r.textContent=a.title;return r})),n.append(e),n}export default async function S(n){const t=await y(f("nav")),e=document.createElement("nav");for(e.id="nav";t.firstElementChild;)e.append(t.firstElementChild);["brand","sections","tools"].forEach((o,u)=>{const i=e.children[u];i&&i.classList.add(`nav-${o}`)});const r=e.querySelector(".nav-brand"),l=r.querySelector(".button");l&&(l.className="",l.closest(".button-container").className="");const{body:s}=document,c=e.querySelector(".nav-sections");c&&(c.querySelectorAll(":scope .default-content-wrapper > ul > li").forEach(o=>{o.querySelector("ul")&&o.classList.add("nav-drop"),o.addEventListener("click",()=>{const u=o.getAttribute("aria-expanded")==="true";toggleAllNavSections(c),o.classList.contains("nav-drop")?(o.setAttribute("aria-expanded",u?"false":"true"),c.setAttribute("aria-expanded",u?"false":"true"),u?s.classList.remove("modal-open"):s.classList.add("modal-open")):(s.classList.remove("modal-open"),o.setAttribute("aria-expanded","false"),c.setAttribute("aria-expanded","false"))})}),c.querySelectorAll(".button-container").forEach(o=>{o.classList.remove("button-container"),o.querySelector(".button").classList.remove("button")}));const p=document.createElement("div");p.classList.add("nav-hamburger"),p.innerHTML=`<button type="button" aria-controls="nav" aria-label="Open navigation">
      <span class="nav-hamburger-icon"></span>
    </button>`;let v=null;p.addEventListener("click",async()=>{if(!v){v=await y(f("mobilenav"));const o=v.querySelector(".default-content-wrapper");o.classList.add("desk-dp-none"),r.prepend(o),o.querySelectorAll("ul ul").forEach(u=>{u.querySelectorAll("ul").forEach(i=>{i.setAttribute("aria-expanded","false"),i.parentElement.querySelector("p").addEventListener("click",()=>{const h=i.getAttribute("aria-expanded")==="true";i.setAttribute("aria-expanded",h?"false":"true"),i.parentElement.setAttribute("aria-expanded",h?"false":"true"),i.parentElement.querySelector("p").classList.toggle("navlist-dropdown")})})})}b(e,c)}),e.prepend(p),e.setAttribute("aria-expanded","false"),b(e,c,d.matches),d.addEventListener("change",()=>b(e,c,d.matches));const m=document.createElement("div");m.className="nav-wrapper",m.append(e),n.append(m),f("breadcrumbs").toLowerCase()==="true"&&m.append(await q())}
