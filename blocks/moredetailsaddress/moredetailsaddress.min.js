import{getMetadata as u}from"../../scripts/aem.min.js";import{CFApiCall as $}from"../../scripts/common.min.js";export const setLocationObj={getExcelData:null,geoInfo:{city:"",state:"",country:"",location:"",locationcode:""}};const E="AIzaSyDx1HwnCLjSSIm_gADqaYAZhSBh7hgcwTQ",T={};export default async function y(t){const o=Array.from(t.children,h=>h.firstElementChild),[a,n,r,e,s,i,l,d]=o,g=d.textContent.trim(),p=(await $(g))?.data;setLocationObj.getExcelData=sessionStorage.getItem("data")?JSON.parse(sessionStorage.getItem("data")):I(p),sessionStorage.getItem("data")||sessionStorage.setItem("data",JSON.stringify(setLocationObj.getExcelData)),i?.querySelector("picture > img")?.setAttribute("alt",l?.textContent?.trim()||"");const c=`
    <div class="address-wrapper">
      <div class="address-title">${a.innerHTML}</div>
      <div class="address-desktop">${n.innerHTML}</div>
      <div class="address-mobile">${r.innerHTML}</div>
      <div class="address-timing">${e.innerHTML}</div>
      <div class="address-info">${s.innerHTML}</div>
      <div class="address-img">${i.innerHTML}</div>
    </div>
  `;t.innerHTML=c,await b(),v()}async function b(){const t=location.href;if(t.split("/").pop().includes("loans-in")){const n=t.split("/").pop().split("-").pop(),e=Object.values(setLocationObj.getExcelData).flat().find(s=>s["Location Code"]==n);e&&(Object.assign(setLocationObj.geoInfo,{state:L(e.State),city:L(e.City),locationcode:e["Location Code"],location:e.Location}),Object.assign(setLocationObj,{lat:e.Latitude,lng:e.Longitude,address:e.Address,pincode:e.Pincode,pagecontent:e["On Page Content"]}))}renderData();const a=await returnLatLan();if(a){setLocationObj.distance=M(setLocationObj.lat,setLocationObj.lng,a.lat,a.lng);const n=document.createElement("li"),r=document.querySelector(".address-info ul");setLocationObj.distance<=40?(n.innerText=`${setLocationObj.distance.toFixed()} Km away from your location`,r.appendChild(n)):n.remove()}setLocationObj.storedata=x(setLocationObj.getExcelData[setLocationObj.geoInfo.state])}function v(){const{city:t,location:o,locationcode:a,state:n}=setLocationObj.geoInfo,r=(S,w=!1)=>{const m=S.toLowerCase().replace(/\s+/g,"-");return w?m.charAt(0).toUpperCase()+m.slice(1):m},e=r(n),s=r(t),i=r(o.replace(/[()/]/g,"").trim()),l=r(n,!0),d=r(t,!0),g=o.charAt(0).toUpperCase()+o.slice(1),p='<span class="breadcrumb-separator"><svg width="6" height="10" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 9.00195L4.29293 5.70902C4.68182 5.32013 4.68182 4.68377 4.29293 4.29488L1 1.00195" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path></svg></span>',c=[`<a href="${u("lang-path")}/branch-locator/${e}">${l}</a>`];s==i?c.push(`<a href="${u("lang-path")}/branch-locator/${e}/${s}">${d}</a>`):s!==i&&(c.push(`<a href="${u("lang-path")}/branch-locator/${e}/${s}">${d}</a>`),c.push(`<a href="${u("lang-path")}/branch-locator/loans-in-${i}-${s}-${e}-${a}">${g}</a>`));const h=c.join(p);document.querySelector("body .breadcrumb nav").insertAdjacentHTML("beforeend",p+h)}function M(t,o,a,n){const e=f(a-t),s=f(n-o),i=Math.sin(e/2)*Math.sin(e/2)+Math.cos(f(t))*Math.cos(f(a))*Math.sin(s/2)*Math.sin(s/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))}function f(t){return t*(Math.PI/180)}function I(t){return t.reduce((o,a)=>{const n=a.State.charAt(0).toUpperCase()+a.State.slice(1).toLowerCase();return o[n]||(o[n]=[]),o[n].push(a),o},{})}function L(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}function x(t){var o=t.filter(function(a){return a.City.toLowerCase()===setLocationObj.geoInfo.city.toLowerCase()});return o}
