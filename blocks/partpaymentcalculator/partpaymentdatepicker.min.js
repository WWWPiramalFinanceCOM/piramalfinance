import{currenyCommaSeperation as D}from"../../scripts/common.min.js;import{updatePartPayment as h}from"./partpaymentlogic.min.js;export let nextMonth,firstElem,secondEle,parentContainer,count=2,array=[];export const partpaymentArra={};export let datepickerObjFirstLoan,airDatePickerObj;function g(a){const e=new Date(a);return e.setMonth(e.getMonth()+1),e.getDate()!==1&&e.setDate(1),e}function x(a){const e=a.split("/");return new Date(e[2],e[0]-1,e[1],16,47,54).toString()}function L(a,e){if(a>e){const n=a;a=e,e=n}let l=(e.getFullYear()-a.getFullYear())*12;return l+=e.getMonth()+(T(a,e)?1:0)-a.getMonth(),l}function T(a,e){const l=Math.abs(e-a);return!(Math.floor(l/(1e3*60*60*24))<30)}function C(a,e){const l=new AirDatepicker(a,{position({$datepicker:n,$target:s,$pointer:i,done:t}){const r=Popper.createPopper(s,n,{placement:"top",modifiers:[{name:"flip",options:{fallbackPlacements:["top","bottom"],padding:{top:10},"z-index":200}},{name:"offset",options:{offset:[0,10]}},{name:"arrow",options:{element:i}}]});return function(){r.destroy(),t()}},onSelect({date:n,formattedDate:s,datepicker:i}){n&&document.querySelector(a).dispatchEvent(new Event("change",{bubbles:!0}))},autoClose:!0,minDate:a=="#firstLoan"?"":e,toggleSelected:!1,locale:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",dateFormat:"MM/dd/yyyy",firstDay:0}});return document.querySelector(a).classList.add("datepickerInit"),l}function E(){const a=document.querySelector(".boxCont"),e=document.querySelectorAll(".partPayment");if(e.length>3){a.classList.add("scrolladd");const n=e[e.length-1].offsetTop;a.scrollTo({top:n,behavior:"smooth"})}else a.classList.contains("scrolladd")&&a.classList.remove("scrolladd")}function P(a,e,l){let n;const s=[a,e],i=document.querySelector("#firstLoan").value;l.addEventListener("change",function(t){if(n=s.every(o=>o.value!=0),n){l.parentElement.parentElement.parentElement.children[2].classList.remove("disabled");const o=l.children[0].children[1].children[0].value,u=l.children[1].children[1].children[0].value;partpaymentArra[this.id]={monthDifference:L(new Date(i),new Date(o)),partPayAmount:u};const c=document.querySelector("[data-cal-input=loanamt]").value,v=document.querySelector("[data-cal-input=roi]").value;if(t.target.classList.contains("slider-value")||t.target.classList.contains("range-slider__range")){array=Object.values(partpaymentArra);var r=document.querySelector("[data-cal-input=tenure]").value;h(v,c,r,array)}else{if(this.nextElementSibling){const y=this.parentNode;let d=this.nextElementSibling;for(;d;){delete partpaymentArra[d.id];const S=d.nextElementSibling;y.removeChild(d),d=S}count=y.children.length+1}array=Object.values(partpaymentArra);var r=document.querySelector("[data-cal-input=tenure]").value;h(v,c,r,array)}E(),document.querySelector(".boxCont").dataset.date=x(l.children[0].children[1].children[0].value)}})}function $(){document.querySelectorAll(".reset").forEach(n=>{n.remove(),delete partpaymentArra[n.id]}),count=2,document.querySelector("#partpayment1").value="",document.querySelector("#partpayment1").disabled=!0,document.querySelector(".partpaymentCardContainer .loanamount .data .inputdivs input").value="0",document.querySelector(".partpaymentCardContainer .loanamount .rangediv input").value="0",document.querySelector(".add-more-part-payment-btn").classList.add("disabled"),document.querySelector("#firstLoan").value="",delete partpaymentArra.partpaymentCardContainer1;const a=document.querySelector("[data-cal-input=loanamt]").value,e=document.querySelector("[data-cal-input=roi]").value;array=Object.values(partpaymentArra);const l=document.querySelector("[data-cal-input=tenure]").value;h(e,a,l,array)}function f(){const a=document.querySelector("#partpayment1");if(a&&a.disabled){const e=a.parentElement;e&&e.classList.add("disabled-parent")}else{const e=a.parentElement;e&&e.classList.remove("disabled-parent")}}function q(){document.querySelectorAll(".slider-value").forEach(e=>{const l=e.dataset.slider,n=document.getElementById(l);e.value=i(n.value),n.addEventListener("input",()=>{s(),e.value=i(n.value)}),e.addEventListener("change",()=>{const t=parseFloat(e.value.replace(/,/g,""),10);n.value=t,s()});function s(){const t=(n.value-n.min)/(n.max-n.min)*100;n.style.background=`linear-gradient(90deg, #da4d34 ${t}%, #dbd7d8 ${t}%)`}n.dispatchEvent(new Event("input"));function i(t){const r=t;return isNaN(Number(r))?0:D(r)}e.addEventListener("input",function(t){let o=e.value.replace(/[^\d.]/g,"");const u=this.dataset.calInput;let c=o;o=String(o),u==="roi"?c=c:u==="tenure"?c=o.replace(/\./g,"").replaceAll(",",""):c=i(c),e.value=c}),e.addEventListener("change",function(){let t=parseFloat(e.value.replaceAll(",",""))||0;const r=parseFloat(n.min),o=parseFloat(n.max);t<r&&(t=r),t>o&&(t=o),n.value=t,this.dataset.calInput==="roi"?e.value=parseFloat(t).toFixed(2):e.value=i(t),s()}),e.addEventListener("focusout",function(){let t=parseFloat(e.value.replaceAll(",",""))||0;const r=parseFloat(n.min),o=parseFloat(n.max);t<r&&(t=r),t>o&&(t=o),n.value=t,this.dataset.calInput==="roi"?e.value=parseFloat(t).toFixed(2):e.value=i(t),s(),e.dispatchEvent(new Event("change",{bubbles:!0}))})})}export function onloadDatePickerCalls(){f(),datepickerObjFirstLoan=C("#firstLoan",new Date);const a=document.querySelector("#firstLoan");let e;a.addEventListener("change",t=>{document.querySelector("#partpayment1").disabled=!0,document.querySelector(".add-more-part-payment-btn").classList.add("disabled"),document.querySelector("#partpayment1").disabled=!1,e=x(document.querySelector("#firstLoan").value),document.querySelector("#partpayment1").classList.contains("datepickerInit")?airDatePickerObj.update({minDate:g(e)}):airDatePickerObj=C("#partpayment1",g(e)),document.querySelector("#partpayment1").value="",document.querySelector(".partpaymentCardContainer .loanamount .data .inputdivs input").value="0",document.querySelector(".partpaymentCardContainer .loanamount .rangediv input").value="0",q(),document.querySelectorAll(".reset").forEach(c=>{c.remove(),delete partpaymentArra[c.id]}),delete partpaymentArra.partpaymentCardContainer1,document.querySelector(".boxCont").dataset.date=g(e);const r=document.querySelector("[data-cal-input=loanamt]").value,o=document.querySelector("[data-cal-input=roi]").value,u=document.querySelector("[data-cal-input=tenure]").value;array=Object.values(partpaymentArra),f(o,r,u,array),f()});const l=[document.querySelector("#partpayment1"),document.querySelector(".partpaymentCardContainer .loanamount .data .inputdivs input")];document.querySelectorAll(".partpaymentCardContainer").forEach(t=>{t.addEventListener("change",function(r){if(l.every(c=>c.value!=0)){document.querySelector(".partpaymentCardContainer").parentElement.parentElement.parentElement.children[2].classList.remove("disabled"),document.querySelector(".boxCont").dataset.date=x(document.querySelector("#partpayment1").value);const c=document.querySelector("#firstLoan").value,v=document.querySelector("#partpayment1").value,m=this.children[1].children[0].children[1].children[1].value;partpaymentArra[this.id]={monthDifference:L(new Date(c),new Date(v)),partPayAmount:m};const y=document.querySelector("[data-cal-input=loanamt]").value,d=document.querySelector("[data-cal-input=roi]").value;var u=document.querySelector("[data-cal-input=tenure]").value;if(r.target.classList.contains("slider-value")||r.target.classList.contains("range-slider__range")){array=Object.values(partpaymentArra);var u=document.querySelector("[data-cal-input=tenure]").value;f(d,y,u,array)}else{if(this.nextElementSibling){const S=this.parentNode;let p=this.nextElementSibling;for(;p;){delete partpaymentArra[p.id];const b=p.nextElementSibling;S.removeChild(p),p=b}count=S.children.length+1}array=Object.values(partpaymentArra),f(d,y,u,array)}}})}),document.querySelector(".add-more-part-payment-btn").addEventListener("click",()=>{document.querySelector(".partpaymentCardContainer").parentElement.parentElement.parentElement.children[2].classList.add("disabled");const{min:t}=document.querySelector(".partpaymentCardContainer .loanamount .rangediv input"),{max:r}=document.querySelector(".partpaymentCardContainer .loanamount .rangediv input"),{value:o}=document.querySelector(".partpaymentCardContainer .loanamount .rangediv input"),u=document.querySelector(".inputdivs.dt img").src,c=document.querySelectorAll(".partpaymentCardContainer .loanamount .rangediv .values .text")[0].innerText,v=document.querySelectorAll(".partpaymentCardContainer .loanamount .rangediv .values .text")[1].innerText;let m;count==1?m=`${count}st`:count==2?m=`${count}nd`:count==3?m=`${count}rd`:count>3&&(m=`${count}th`);const y=`Enter ${m} part payment Date`,d=`${m} Part Payment amount (Rs.)`,S=document.querySelector(".boxCont"),p=document.createElement("div");p.setAttribute("id",`partpaymentCardContainer${count}`),p.classList.add("loanamount","partPayment","partpaymentCardContainer",`resetClass${count}`,"reset");const b=`<div class="data"><label class="description">${y}</label><div class="inputdivs dt"><input type="text" class="inputvalue " placeholder="DD/MM/YYYY" readonly id="partpayment${count}"><img src="${u}" alt="image"></div></div><div class="loanamount"><div class="data"><label class="description">${d}</label><div class="inputdivs "><span class="rupee">\u20B9</span><input type="text" class="inputvalue  slider-value" value="" data-slider="partPayment${count}" id="partPaymentInput${count}"><span class="textvalue"></span></div></div><div class="rangediv"><input type="range" min="${t}" max="${r}" value="0" class="range-slider__range" id="partPayment${count}"style="background: linear-gradient(90deg, rgb(218, 77, 52) 4.0404%, rgb(219, 215, 216) 4.0404%);"><div class="values"><span class="text">${c}</span><span class="text">${v}</span></div></div></div>`;p.innerHTML=b,S.append(p),parentContainer=document.querySelector(`.resetClass${count}`),firstElem=document.querySelector(`#partPaymentInput${count}`),secondEle=document.querySelector(`#partpayment${count}`),C(`#partpayment${count}`,g(document.querySelector(".boxCont").dataset.date)),q(),count+=1,P(firstElem,secondEle,parentContainer),E()}),q();const n=document.querySelector("[data-cal-input=loanamt]").value,s=document.querySelector("[data-cal-input=roi]").value,i=document.querySelector("[data-cal-input=tenure]").value;h(s,n,i,[]),document.querySelector(".emicalculator .inputDiv").addEventListener("change",t=>{const{target:r}=t,o=document.querySelector("[data-cal-input=loanamt]").value,u=document.querySelector("[data-cal-input=roi]").value,c=document.querySelector("[data-cal-input=tenure]").value;h(u,o,c,array)}),document.querySelector(".clearAllText").addEventListener("click",()=>{$(),q(),datepickerObjFirstLoan.clear(),airDatePickerObj.clear(),f(),document.querySelector(".boxCont").classList.remove("scrolladd")})}
