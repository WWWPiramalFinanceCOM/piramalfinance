export default class m{constructor(t={}){this.name=t.name||"Block",this.block=t.block,this.blockItem=t.blockItem||null,this.blockRows=Array.isArray(t.blockRows)?t.blockRows:[],this.itemRows=Array.isArray(t.itemRows)?t.itemRows:[],this.removeAfterInsert=!!t.removeAfterInsert,this.sectionMeta=t.sectionMeta||null}find(t){const e=t||(typeof document<"u"?document.body:null);return e?this.block?[...e.querySelectorAll(this.block)].map(l=>{const r=l.parentElement,o=r?[...r.children].indexOf(l):-1;return{el:l,parent:r,indexInParent:o,isRootFallback:!1}}):[{el:e,parent:e,indexInParent:0,isRootFallback:!0}]:[]}static extractValue(t,e,c){if(!t||!e)return"";if(typeof e=="string"){const l=/^([#\.]?[a-zA-Z_][a-zA-Z0-9_-]*)(::?[a-zA-Z0-9_-]+)?$/;return t.querySelector(e)||(l.test(e)?"":e)||""}if(typeof e=="function")try{return e(t,c)||""}catch{return""}return""}cellMaker(t,e){const c=this.find(t);if(!c.length)return null;const l=[];return c.forEach(({el:r,parent:o,isRootFallback:f})=>{const i=[[this.name]];this.blockRows.length&&this.blockRows.forEach(s=>{if(Array.isArray(s)){const n=s.map(u=>this.constructor.extractValue(r,u,e));i.push(n)}else{const n=this.constructor.extractValue(r,s,e);i.push([n])}});const a=this.blockItem?[...r.querySelectorAll(this.blockItem)]:[];if(a.length&&this.itemRows.length?a.forEach(s=>{const n=this.itemRows.map(u=>Array.isArray(u)?u.map(b=>this.constructor.extractValue(s,b,e)):this.constructor.extractValue(s,u,e)).flat();i.push(n)}):a.length&&this.itemRows.length===0?a.forEach(s=>i.push([s])):!a.length&&this.blockRows.length===0&&i.push([r]),i.length<2)return;const h=WebImporter.DOMUtils.createTable(i,e);if(this.sectionMeta){const s=e.createElement("hr"),n=WebImporter.DOMUtils.createTable(this.sectionMeta,e);f?t.insertBefore(s,t.firstChild):o&&o.insertBefore(s,r),s.after(h),h.after(n)}else f?t.insertBefore(h,t.firstChild):o&&o.insertBefore(h,r);l.push(h),this.removeAfterInsert&&r.remove()}),l.length===0?null:l.length===1?l[0]:l}}
